<!doctype html><html itemscope lang=ko-kr itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><meta name=theme-name content="hugoplate"><link rel="shortcut icon" href=/images/favicon_hu2575224fe8b7f0ea91e8825e42ecaf67_1499445_96x0_resize_lanczos_3.png type=image/x-icon><link rel=icon href=/images/favicon_hu2575224fe8b7f0ea91e8825e42ecaf67_1499445_96x0_resize_lanczos_3.png type=image/x-icon><link rel=icon type=image/png sizes=48x48 href=/images/favicon_hu2575224fe8b7f0ea91e8825e42ecaf67_1499445_48x0_resize_lanczos_3.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon_hu2575224fe8b7f0ea91e8825e42ecaf67_1499445_96x0_resize_lanczos_3.png><link rel=apple-touch-icon sizes=144x144 href=/images/favicon_hu2575224fe8b7f0ea91e8825e42ecaf67_1499445_144x0_resize_lanczos_3.png><link rel=manifest href=/manifest.webmanifest><meta name=msapplication-TileColor content="#ddd"><meta name=theme-color content="#ffffff"><base href=https://gowoonsori.com/blog/projects/spring-graphql/security/><title>Spring Security 적용해보기</title>
<meta name=generator content="Hugo 0.120.2"><meta name=keywords content="Gromit,Tech,Blog,gowoonsori"><meta name=description content="springboot GraphQL서버에 SpringSecurity 적용해보기"><meta name=author content="gowoonsori"><meta property="og:image" content="https://gowoonsori.com/images/projects/spring-graphql/preview.png"><meta name=twitter:image content="https://gowoonsori.com/images/projects/spring-graphql/preview.png"><meta name=twitter:card content="summary"><meta property="og:image:width" content="256"><meta property="og:image:height" content="256"><meta property="og:image:type" content="image/
        .png
      "><meta property="og:title" content="Spring Security 적용해보기"><meta property="og:description" content="springboot GraphQL서버에 SpringSecurity 적용해보기"><meta property="og:type" content="website"><meta property="og:url" content="https://gowoonsori.com/blog/projects/spring-graphql/security/"><meta name=twitter:title content="Spring Security 적용해보기"><meta name=twitter:description content="springboot GraphQL서버에 SpringSecurity 적용해보기"><script async src="https://www.googletagmanager.com/gtag/js?id=G-NB8ZZY0RDG"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NB8ZZY0RDG",{anonymize_ip:!1})}</script><script>!function(){let e=0;document.addEventListener("mousemove",function(){1==++e&&gtmLoader()}),window.onscroll=function(){1==++e&&gtmLoader()},setTimeout(function(){0===e&&(e++,gtmLoader())},5e3)}();function gtmLoader(){(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","G-NB8ZZY0RDG")}</script><script>let indexURL="https://gowoonsori.com/searchindex.json",includeSectionsInSearch=["blog"],no_results_for="No results for",empty_search_results_placeholder="Type something to search.."</script><meta http-equiv=x-dns-prefetch-control content="on"><link rel=preconnect href=https://use.fontawesome.com crossorigin><link rel=preconnect href=//cdnjs.cloudflare.com><link rel=preconnect href=//www.googletagmanager.com><link rel=preconnect href=//www.google-analytics.com><link rel=dns-prefetch href=https://use.fontawesome.com><link rel=dns-prefetch href=//ajax.googleapis.com><link rel=dns-prefetch href=//cdnjs.cloudflare.com><link rel=dns-prefetch href=//www.googletagmanager.com><link rel=dns-prefetch href=//www.google-analytics.com><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//connect.facebook.net><link rel=dns-prefetch href=//platform.linkedin.com><link rel=dns-prefetch href=//platform.twitter.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600&family=Signika:wght@500;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><link href="/css/style.min.7f79edb8cd8b89cf1fa077c3ef1fc27c23db7dbf0f36180213e0101f52c366f2.css" integrity="sha256-f3ntuM2Lic8foHfD7x/CfCPbfb8PNhgCE+AQH1LDZvI=" rel=stylesheet><link rel=stylesheet href="/css/style-lazy.min.6ebccd46bdfd6a8861cd49c725f28b8615081591f753245c453e861a11c4b5b4.css" integrity="sha256-brzNRr39aohhzUnHJfKLhhUIFZH3UyRcRT6GGhHEtbQ=" media=print onload='this.media="all",this.onload=null'></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-NB8ZZY0RDG" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><header class="header sticky top-0 z-30"><nav class="navbar container"><div class=order-0><a class="navbar-brand block" href=/><img fetchpriority=high decoding=async class="img logo-light" width=160 height=32 src=/images/logo_huecbda5afdfa6f2a47d87fa44d8964534_89529_320x0_resize_q90_h2_lanczos_3.webp alt=Gromit.Blog onerror='this.onerror=null,this.src="/images/logo_huecbda5afdfa6f2a47d87fa44d8964534_89529_320x0_resize_lanczos_3.png"'>
<img fetchpriority=high decoding=async class="img logo-dark" width=160 height=32 src=/images/logo-darkmode_hu2877729f4be0141a60f84355100d8d94_80775_320x0_resize_q90_h2_lanczos_3.webp alt=Gromit.Blog onerror='this.onerror=null,this.src="/images/logo-darkmode_hu2877729f4be0141a60f84355100d8d94_80775_320x0_resize_lanczos_3.png"'></a></div><input id=nav-toggle type=checkbox class=hidden>
<label for=nav-toggle class="order-3 cursor-pointer flex items-center lg:hidden text-dark dark:text-white lg:order-1"><svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20"><title>Menu Open</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0V0z"/></svg><svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20"><title>Menu Close</title><polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"/></svg></label><ul id=nav-menu class="navbar-nav order-3 hidden lg:flex w-full pb-6 lg:order-1 lg:w-auto lg:space-x-2 lg:pb-0 xl:space-x-8"><li class=nav-item><a class=nav-link href=/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=/categories/>Categories</a></li><li class=nav-item><a class=nav-link href=/tags/>Tags</a></li><li class=nav-item><a class=nav-link href=/about>About</a></li></ul><div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0"><button aria-label=search class="border-border text-dark hover:text-primary dark:border-darkmode-border mr-5 inline-block border-r pr-5 text-xl dark:text-white" data-target=search-modal>
<i class="fa-solid fa-search"></i></button><div class="theme-switcher mr-5"><input id=theme-switcher data-theme-switcher type=checkbox>
<label for=theme-switcher><span class=sr-only>theme switcher</span>
<span><svg class="absolute left-[4px] top-[4px] z-10 opacity-100 dark:opacity-0" viewBox="0 0 56 56" fill="#fff" height="16" width="16"><path d="M30 4.6c0-1-.9-2-2-2a2 2 0 00-2 2v5c0 1 .9 2 2 2s2-1 2-2zm9.6 9a2 2 0 000 2.8c.8.8 2 .8 2.9.0L46 13a2 2 0 000-2.9 2 2 0 00-3 0zm-26 2.8c.7.8 2 .8 2.8.0.8-.7.8-2 0-2.9L13 10c-.7-.7-2-.8-2.9.0-.7.8-.7 2.1.0 3zM28 16A12 12 0 0016 28a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0028 16zm23.3 14c1.1.0 2-.9 2-2s-.9-2-2-2h-4.9a2 2 0 00-2 2c0 1.1 1 2 2 2zM4.7 26a2 2 0 00-2 2c0 1.1.9 2 2 2h4.9c1 0 2-.9 2-2s-1-2-2-2zm37.8 13.6a2 2 0 00-3 0 2 2 0 000 2.9l3.6 3.5a2 2 0 002.9.0c.8-.8.8-2.1.0-3zM10 43.1a2 2 0 000 2.9c.8.7 2.1.8 3 0l3.4-3.5c.8-.8.8-2.1.0-2.9s-2-.8-2.9.0zm20 3.4c0-1.1-.9-2-2-2a2 2 0 00-2 2v4.9c0 1 .9 2 2 2s2-1 2-2z"/></svg><svg class="absolute left-[4px] top-[4px] z-10 opacity-0 dark:opacity-100" viewBox="0 0 24 24" fill="none" height="16" width="16"><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M8.2 2.2c1-.4 2 .6 1.6 1.5-1 3-.4 6.4 1.8 8.7a8.4 8.4.0 008.7 1.8c1-.3 2 .5 1.5 1.5v.1A10.3 10.3.0 0112.4 22 10.3 10.3.0 013.2 6.7c1-2 2.9-3.5 4.9-4.4z"/></svg></span></label></div><script>var darkMode=!0,themeSwitch;localStorage.getItem("theme")==="dark"?darkMode=!0:localStorage.getItem("theme")==="light"&&(darkMode=!1),darkMode&&document.documentElement.classList.toggle("dark"),themeSwitch=document.querySelectorAll("[data-theme-switcher]"),document.addEventListener("DOMContentLoaded",()=>{[].forEach.call(themeSwitch,function(e){e.checked=!!darkMode,e.addEventListener("click",()=>{document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light"),setGiscusTheme()})})});function getGiscusTheme(){return localStorage.getItem("theme")==="dark"?"dark":"light"}function setGiscusTheme(){function e(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}e({setConfig:{theme:getGiscusTheme()}})}</script></div></nav></header><div class="search-wrapper search-modal" data-image=true data-description=true data-tags=true data-categories=true tabindex=-1 aria-hidden=true style=--color-primary:#121212><div class=search-wrapper-content><div class=search-input-body><label for=search-modal-input style=margin-top:-1px><span class=sr-only>search icon</span>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="18" width="18" class="search-icon" data-type="search"><path fill="currentcolor" d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8.0 45.3s-32.8 12.5-45.3.0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9.0 208S93.1.0 208 0 416 93.1 416 208zM208 352a144 144 0 100-288 144 144 0 100 288z"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="18" width="18" class="search-reset" data-type="reset"><path fill="currentcolor" d="M256 512A256 256 0 10256 0a256 256 0 100 512zM175 175c9.4-9.4 24.6-9.4 33.9.0l47 47 47-47c9.4-9.4 24.6-9.4 33.9.0s9.4 24.6.0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6.0 33.9s-24.6 9.4-33.9.0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9.0s-9.4-24.6.0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6.0-33.9z"/></svg></label><input id=search-modal-input type=text data-search-input autocomplete=off aria-label=Search placeholder="Search Post ..."></div><div class=search-wrapper-body><div class=search-result data-search-result></div><span class=search-result-empty>Type something to search..</span></div><div class=search-wrapper-footer><span><kbd><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentcolor" style="margin-top:-2px" viewBox="0 0 16 16"><path d="M3.204 11h9.592L8 5.519 3.204 11zm-.753-.659 4.796-5.48a1 1 0 011.506.0l4.796 5.48c.566.647.106 1.659-.753 1.659H3.204a1 1 0 01-.753-1.659z"/></svg></kbd><kbd><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentcolor" style="margin-top:1px" viewBox="0 0 16 16"><path d="M3.204 5h9.592L8 10.481 3.204 5zm-.753.659 4.796 5.48a1 1 0 001.506.0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 00-.753 1.659z"/></svg></kbd>to navigate
</span><span><kbd><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentcolor" style="display:inline-block" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M14.5 1.5a.5.5.0 01.5.5v4.8a2.5 2.5.0 01-2.5 2.5H2.707l3.347 3.346a.5.5.0 01-.708.708l-4.2-4.2a.5.5.0 010-.708l4-4a.5.5.0 11.708.708L2.707 8.3H12.5A1.5 1.5.0 0014 6.8V2a.5.5.0 01.5-.5z"/></svg></kbd>to select
</span><span class=search-result-info></span>
<span data-target=close-search-modal><kbd>ESC</kbd> to close</span></div></div></div><main><section class="section pt-7"><div class=container><div class="row justify-center"><article class=lg:col-10><h1 class="h2 mb-4">Spring Security 적용해보기</h1><ul class=mb-4><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/projects/ class=ms-1>Projects</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-clock mr-2"></i>
2021년 4월 1일</li></ul><div class="content mb-10 mt-9"><p>지난번에 spring boot를 이용해서 graphQL서버를 구성해보았는데, 서비스를 운영할때 가장 중요한 <strong>보안</strong>을 설정하기 위해 springSecurity를 적용한 사례를 작성해보려고 한다.</p><p>우선, 인증 방식을 선택해야 하는데, 버스정보 어플같은 경우 사용자를 구분할 별도의 인증이 필요없기 때문에 간단하게 <strong>api-key</strong>를 통한 인증을 구현해보았다. graphQL로 kickstart 라이브러리를 이용하여 구현했기 때문에 다른 라이브러리를 이용했다면 Resolver와 같은 Handler클래스는 형식이 달라질 수 있다.</p><h2 id=1-라이브러리-추가>1. 라이브러리 추가</h2><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>dependencies {
</span></span><span style=display:flex><span>  ... 그 외 라이브러리
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  //spring security
</span></span><span style=display:flex><span>  compile &#34;org.springframework.boot:spring-boot-starter-security&#34;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>gradle은 위와 같이 한줄을 추가 해주면 되고 maven은 <a href=https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-security target=_blank>maven repository</a>
에서 버전을 선택해 의존성 추가해주면된다.</p><p><br><br></p><h2 id=2-websecurityconfigureradapter를-상속받은-config클래스-생성>2. WebSecurityConfigurerAdapter를 상속받은 Config클래스 생성</h2><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#61afef>@EnableWebSecurity</span>
</span></span><span style=display:flex><span><span style=color:#61afef>@EnableGlobalMethodSecurity</span>(<span style=color:#e06c75>prePostEnabled</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>true</span>)
</span></span><span style=display:flex><span><span style=color:#61afef>@RequiredArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#c678dd>class</span> <span style=color:#e5c07b>GraphQLSecurityConfig</span> <span style=color:#c678dd>extends</span> <span style=color:#e06c75>WebSecurityConfigurerAdapter</span> {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#c678dd>static</span> <span style=color:#c678dd>final</span> <span style=color:#e06c75>String</span> <span style=color:#e06c75>USER_ID_PRE_AUTH_HEADER</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#34;api_key&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#61afef>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>protected</span> <span style=color:#e5c07b>void</span> <span style=color:#61afef;font-weight:700>configure</span>(<span style=color:#e06c75>HttpSecurity</span> <span style=color:#e06c75>http</span>) <span style=color:#c678dd>throws</span> <span style=color:#e06c75>Exception</span> {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>http</span>
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// api-key auth 필터 추가</span>
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>addFilterBefore</span>(<span style=color:#c678dd>new</span> <span style=color:#e06c75>ApiKeyAuthenticationFilter</span>(), <span style=color:#e06c75>UsernamePasswordAuthenticationFilter</span>.<span style=color:#e06c75>class</span>)
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>authorizeRequests</span>()
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// 모든 endpoint는 인증이 필요</span>
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>anyRequest</span>().<span style=color:#e06c75>authenticated</span>()
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>and</span>()
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// session manager filter 사용 x</span>
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>sessionManagement</span>().<span style=color:#e06c75>sessionCreationPolicy</span>(<span style=color:#e06c75>SessionCreationPolicy</span>.<span style=color:#e06c75>STATELESS</span>)
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>and</span>()
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>csrf</span>().<span style=color:#e06c75>disable</span>()
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>httpBasic</span>().<span style=color:#e06c75>disable</span>()
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// Disable the /logout filter</span>
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>logout</span>().<span style=color:#e06c75>disable</span>()
</span></span><span style=display:flex><span>            <span style=color:#7f848e>// Disable anonymous users</span>
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>anonymous</span>().<span style=color:#e06c75>disable</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#61afef>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e5c07b>void</span> <span style=color:#61afef;font-weight:700>configure</span>(<span style=color:#e06c75>WebSecurity</span> <span style=color:#e06c75>web</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>web</span>.<span style=color:#e06c75>ignoring</span>().<span style=color:#e06c75>antMatchers</span>(<span style=color:#98c379>&#34;/playground&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>spiring security를 의존성 추가만 해줘도 springsecurity filter들이 자동으로 등록되어 모든 도메인에대한 접속이 인증이 필요하게 되는데 우리는 서버 접속에 id/pw방식을 사용하지 않을 것이기 때문에 filter를 custom해주어야한다.</p><p>그래서 WebSecurityConfigurerAdapter를 상속하여 <strong>configure</strong>메서드를 오버라이딩 해주어 재설정 해주면된다. <strong>@EnableWebSecurity</strong>어노테이션을 달면 springSecurity filter들이 자동으로 포함되고, <strong>@EnableGlobalMethodSecurity(prePostEnabled = true)</strong> 어노테이션을 통해 컨트롤러에 존재하는 메서드들에 <strong>@PreAuthorize()</strong> 어노테이션을 통해 권한여부를 파악할 수 있게 해준다.</p><p>graphQL은 endpoint가 한개이므로 도메인별 권한을 config에서 부여하기 힘들기 대문에 이 어노테이션 방식을 통해 권한을 인증하는 방식으로 구성해야 한다.</p><p>configure메서드를 통해 기본인증방식인 form방식/session/httpBasic등을 비활성화 해주고, 웹으로 <strong>/playground</strong> 접속을 할 수 있게 WebSecurity를 매개변수로 갖는 configure메서드에서 위와 같이 추가해주었다.</p><p><br><br></p><h2 id=3-filter-추가>3. Filter 추가</h2><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#c678dd>class</span> <span style=color:#e5c07b>ApiKeyAuthenticationFilter</span> <span style=color:#c678dd>implements</span> <span style=color:#e06c75>Filter</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#61afef>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e5c07b>void</span> <span style=color:#61afef;font-weight:700>doFilter</span>(<span style=color:#e06c75>ServletRequest</span> <span style=color:#e06c75>request</span>, <span style=color:#e06c75>ServletResponse</span> <span style=color:#e06c75>response</span>, <span style=color:#e06c75>FilterChain</span> <span style=color:#e06c75>chain</span>) <span style=color:#c678dd>throws</span> <span style=color:#e06c75>IOException</span>, <span style=color:#e06c75>ServletException</span> {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span>(<span style=color:#e06c75>request</span> <span style=color:#c678dd>instanceof</span> <span style=color:#e06c75>HttpServletRequest</span> <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>response</span> <span style=color:#c678dd>instanceof</span> <span style=color:#e06c75>HttpServletResponse</span>){
</span></span><span style=display:flex><span>            <span style=color:#e06c75>String</span> <span style=color:#e06c75>apiKey</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>getApiKey</span>((<span style=color:#e06c75>HttpServletRequest</span>) <span style=color:#e06c75>request</span>);
</span></span><span style=display:flex><span>            <span style=color:#c678dd>if</span>(<span style=color:#e06c75>apiKey</span> <span style=color:#56b6c2>!=</span> <span style=color:#e5c07b>null</span>){
</span></span><span style=display:flex><span>                <span style=color:#e06c75>ApiKeyAuthenticationToken</span> <span style=color:#e06c75>apiToken</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>ApiKeyAuthenticationToken</span>(<span style=color:#e06c75>apiKey</span>);
</span></span><span style=display:flex><span>                <span style=color:#e06c75>SecurityContextHolder</span>.<span style=color:#e06c75>getContext</span>().<span style=color:#e06c75>setAuthentication</span>(<span style=color:#e06c75>apiToken</span>);
</span></span><span style=display:flex><span>            }<span style=color:#c678dd>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#e06c75>HttpServletResponse</span> <span style=color:#e06c75>httpResponse</span> <span style=color:#56b6c2>=</span> (<span style=color:#e06c75>HttpServletResponse</span>) <span style=color:#e06c75>response</span>;
</span></span><span style=display:flex><span>                <span style=color:#e06c75>httpResponse</span>.<span style=color:#e06c75>setStatus</span>(<span style=color:#e06c75>403</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#e06c75>chain</span>.<span style=color:#e06c75>doFilter</span>(<span style=color:#e06c75>request</span>, <span style=color:#e06c75>response</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#c678dd>private</span> <span style=color:#e06c75>String</span> <span style=color:#61afef;font-weight:700>getApiKey</span>(<span style=color:#e06c75>HttpServletRequest</span> <span style=color:#e06c75>httpRequest</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>httpRequest</span>.<span style=color:#e06c75>getHeader</span>(<span style=color:#e06c75>USER_ID_PRE_AUTH_HEADER</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>필터를 하나 생성하여 http요청 헤더에서 <strong>api-key</strong>라는 헤더가 있는지 검사하는 로직을 수행하게 해주었는데, filter를 custom으로 생성을 해주었으면 <strong>chain.doFilter(req,res)</strong> 를 꼭 넣어줘어야 필터체인의 다음 필터를 이어서 수행하기 때문에 빼먹지말자.</p><p>헤더에 api-key가 존재하면 해당 api-key가 유요한 key인지 인증(검사)를 해야 하기 때문에 를 Set해주면 된다.</p><h3 id=1-커스텀-인증-객체-생성>1) 커스텀 인증 객체 생성</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#c678dd>class</span> <span style=color:#e5c07b>ApiKeyAuthenticationToken</span> <span style=color:#c678dd>extends</span> <span style=color:#e06c75>AbstractAuthenticationToken</span> {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>private</span> <span style=color:#e06c75>String</span> <span style=color:#e06c75>apiKey</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#61afef;font-weight:700>ApiKeyAuthenticationToken</span>(<span style=color:#e06c75>String</span> <span style=color:#e06c75>apiKey</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>super</span>(<span style=color:#e5c07b>null</span>);
</span></span><span style=display:flex><span>        <span style=color:#c678dd>this</span>.<span style=color:#e06c75>apiKey</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>apiKey</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#61afef;font-weight:700>ApiKeyAuthenticationToken</span>(<span style=color:#e06c75>Collection</span><span style=color:#56b6c2>&lt;?</span> <span style=color:#c678dd>extends</span> <span style=color:#e06c75>GrantedAuthority</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>authorities</span>, <span style=color:#e06c75>String</span> <span style=color:#e06c75>apiKey</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>super</span>(<span style=color:#e06c75>authorities</span>);
</span></span><span style=display:flex><span>        <span style=color:#c678dd>this</span>.<span style=color:#e06c75>apiKey</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>apiKey</span>;
</span></span><span style=display:flex><span>        <span style=color:#e06c75>setAuthenticated</span>(<span style=color:#e5c07b>true</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#61afef>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e06c75>Object</span> <span style=color:#61afef;font-weight:700>getCredentials</span>() {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>return</span> <span style=color:#e5c07b>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#61afef>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e06c75>Object</span> <span style=color:#61afef;font-weight:700>getPrincipal</span>() {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>apiKey</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>SecurityContexholder에 추가해줄 Custom한 Authentication객체를 만들어야 하는데 <strong>AbstractAuthenticationToken</strong>을 상속받아 객체를 정의 해주면 되고 apiKey만 파라미터로하는 생성자는 인증전의 객체이며, Role을 담은 authorities를 포함하여 객체를 생성하면 인증 후의 객체로 <strong>setAuthrenticatd(true)</strong> 을 수행해주면 된다.</p><p>위의 필터에서는 apikey만을 파라미터로 주고있기 때문에 apikey가 있는지 검사하는 필터일 뿐이지 인증을 수행하지는 않은 상태이다.</p><p><br><br></p><h2 id=4-provider-생성>4. Provider 생성</h2><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#61afef>@Component</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#c678dd>class</span> <span style=color:#e5c07b>ApiKeyProvider</span> <span style=color:#c678dd>implements</span> <span style=color:#e06c75>AuthenticationProvider</span> {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>private</span> <span style=color:#c678dd>final</span> <span style=color:#e06c75>AuthProperties</span> <span style=color:#e06c75>authProperties</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#61afef;font-weight:700>ApiKeyProvider</span>(<span style=color:#e06c75>AuthProperties</span> <span style=color:#e06c75>authProperties</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>this</span>.<span style=color:#e06c75>authProperties</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>authProperties</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#61afef>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e06c75>Authentication</span> <span style=color:#61afef;font-weight:700>authenticate</span>(<span style=color:#e06c75>Authentication</span> <span style=color:#e06c75>authentication</span>) <span style=color:#c678dd>throws</span> <span style=color:#e06c75>AuthenticationException</span> {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span>(<span style=color:#e06c75>authentication</span>.<span style=color:#e06c75>isAuthenticated</span>()) <span style=color:#c678dd>return</span> <span style=color:#e06c75>authentication</span>;
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span>(<span style=color:#e06c75>authentication</span>.<span style=color:#e06c75>getPrincipal</span>().<span style=color:#e06c75>toString</span>().<span style=color:#e06c75>equals</span>(<span style=color:#e06c75>authProperties</span>.<span style=color:#e06c75>getApiKey</span>().<span style=color:#e06c75>get</span>(<span style=color:#98c379>&#34;user&#34;</span>))){
</span></span><span style=display:flex><span>            <span style=color:#e06c75>ApiKeyAuthenticationToken</span> <span style=color:#e06c75>token</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>ApiKeyAuthenticationToken</span>(<span style=color:#e06c75>AuthorityUtils</span>.<span style=color:#e06c75>createAuthorityList</span>(<span style=color:#98c379>&#34;user&#34;</span>),<span style=color:#e06c75>authentication</span>.<span style=color:#e06c75>getPrincipal</span>().<span style=color:#e06c75>toString</span>());
</span></span><span style=display:flex><span>            <span style=color:#e06c75>token</span>.<span style=color:#e06c75>setAuthenticated</span>(<span style=color:#e5c07b>true</span>);
</span></span><span style=display:flex><span>            <span style=color:#c678dd>return</span> <span style=color:#e06c75>token</span>;
</span></span><span style=display:flex><span>        }<span style=color:#c678dd>else</span> <span style=color:#c678dd>if</span>(<span style=color:#e06c75>authentication</span>.<span style=color:#e06c75>getPrincipal</span>().<span style=color:#e06c75>toString</span>().<span style=color:#e06c75>equals</span>(<span style=color:#e06c75>authProperties</span>.<span style=color:#e06c75>getApiKey</span>().<span style=color:#e06c75>get</span>(<span style=color:#98c379>&#34;bus&#34;</span>))){
</span></span><span style=display:flex><span>            <span style=color:#e06c75>ApiKeyAuthenticationToken</span> <span style=color:#e06c75>token</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>ApiKeyAuthenticationToken</span>(<span style=color:#e06c75>AuthorityUtils</span>.<span style=color:#e06c75>createAuthorityList</span>(<span style=color:#98c379>&#34;bus&#34;</span>),<span style=color:#e06c75>authentication</span>.<span style=color:#e06c75>getPrincipal</span>().<span style=color:#e06c75>toString</span>());
</span></span><span style=display:flex><span>            <span style=color:#e06c75>token</span>.<span style=color:#e06c75>setAuthenticated</span>(<span style=color:#e5c07b>true</span>);
</span></span><span style=display:flex><span>            <span style=color:#c678dd>return</span> <span style=color:#e06c75>token</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#c678dd>else</span> <span style=color:#c678dd>throw</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>AccessDeniedException</span>(<span style=color:#98c379>&#34;invalid api-key&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#61afef>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e5c07b>boolean</span> <span style=color:#61afef;font-weight:700>supports</span>(<span style=color:#e06c75>Class</span><span style=color:#56b6c2>&lt;?&gt;</span> <span style=color:#e06c75>authentication</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>ApiKeyAuthenticationToken</span>.<span style=color:#e06c75>class</span>.<span style=color:#e06c75>isAssignableFrom</span>(<span style=color:#e06c75>authentication</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>UsernamePasswordAuthenticationFilter</strong>, <strong>BasicAuthenticationFilter</strong>, <strong>FilterSecurityInterceptor</strong>에서 Authentication Manager를 통해 Authentication객체의 인증을 수행하게 되는데 이때 Manger는 각종 Provider를 이용해서 인증객체를 인증한다.</p><p>많은 Provider중에서 <strong>supports</strong>메서드를 통해 인증할 객체타입에 맞는 Provider를 찾아 인증을 수행하기 때문에 일일히 Filter에서 특정 Provider를 사용하도록 Manager에게 알려줄 필요가 없다. 그래서 Provider를 정의할때는 supports도 override하여 해당 객체타입임을 알려주어야 한다.</p><p>Manager가 적합한 provider를 찾으면 수행하는 메서드인 <strong>authenticate</strong>를 override하여 여기에 인증 과정을 정의해주면 된다. 나는 application.properties에 미리 api-key를 생성해놓고 이를 이용해 비교로직을 수행하기 위해 AuthProperties라는 객체를 따로 빈으로 생성해서 .properties의 값을 가져오도록 했다.</p><p>값이 같다면 역할(Authority)을 포함한 인증객체를 생성해 return하여 인증객체가 인증되었음( <strong>setAuthenticated(true)</strong> )을 수행토록 했다.</p><p><br><br></p><h2 id=5-controller의-메서드들에-preauthorize추가>5. controller의 메서드들에 @PreAuthorize추가</h2><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#61afef>@Component</span>
</span></span><span style=display:flex><span><span style=color:#61afef>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#c678dd>class</span> <span style=color:#e5c07b>WetayoQuery</span> <span style=color:#c678dd>implements</span> <span style=color:#e06c75>GraphQLQueryResolver</span> {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>private</span> <span style=color:#c678dd>final</span> <span style=color:#e06c75>StationService</span> <span style=color:#e06c75>stationService</span>;
</span></span><span style=display:flex><span>    <span style=color:#c678dd>private</span> <span style=color:#c678dd>final</span> <span style=color:#e06c75>RouteStationService</span> <span style=color:#e06c75>routeStationService</span>;
</span></span><span style=display:flex><span>    <span style=color:#c678dd>private</span> <span style=color:#c678dd>final</span> <span style=color:#e06c75>RideService</span> <span style=color:#e06c75>rideService</span>;
</span></span><span style=display:flex><span>    <span style=color:#c678dd>private</span> <span style=color:#c678dd>final</span> <span style=color:#e06c75>RouteService</span> <span style=color:#e06c75>routeService</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>private</span> <span style=color:#c678dd>final</span> <span style=color:#e06c75>ModelMapper</span> <span style=color:#e06c75>modelMapper</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>WetayoQuery</span>(<span style=color:#e06c75>StationService</span> <span style=color:#e06c75>stationService</span>, <span style=color:#e06c75>ModelMapper</span> <span style=color:#e06c75>modelMapper</span>, <span style=color:#e06c75>RouteStationService</span> <span style=color:#e06c75>routeStationService</span>
</span></span><span style=display:flex><span>            , <span style=color:#e06c75>RideService</span> <span style=color:#e06c75>rideService</span>, <span style=color:#e06c75>RouteService</span> <span style=color:#e06c75>routeService</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>this</span>.<span style=color:#e06c75>stationService</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>stationService</span>;
</span></span><span style=display:flex><span>        <span style=color:#c678dd>this</span>.<span style=color:#e06c75>modelMapper</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>modelMapper</span>;
</span></span><span style=display:flex><span>        <span style=color:#c678dd>this</span>.<span style=color:#e06c75>routeStationService</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>routeStationService</span>;
</span></span><span style=display:flex><span>        <span style=color:#c678dd>this</span>.<span style=color:#e06c75>rideService</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>rideService</span>;
</span></span><span style=display:flex><span>        <span style=color:#c678dd>this</span>.<span style=color:#e06c75>routeService</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>routeService</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#61afef>@PreAuthorize</span>(<span style=color:#98c379>&#34;hasAuthority(&#39;user&#39;)&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>RouteStationGraphQLDto</span><span style=color:#56b6c2>&gt;</span> <span style=color:#61afef;font-weight:700>getStations</span>(<span style=color:#e06c75>Double</span> <span style=color:#e06c75>x</span>, <span style=color:#e06c75>Double</span> <span style=color:#e06c75>y</span>, <span style=color:#e06c75>Double</span> <span style=color:#e06c75>distance</span>, <span style=color:#e06c75>DataFetchingEnvironment</span> <span style=color:#e06c75>e</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Station</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>stations</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>stationService</span>.<span style=color:#e06c75>getNearByStations</span>(<span style=color:#e06c75>x</span>, <span style=color:#e06c75>y</span>, <span style=color:#e06c75>distance</span>);
</span></span><span style=display:flex><span>        <span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>RouteStationGraphQLDto</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>routeStationDtos</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>ArrayList</span><span style=color:#56b6c2>&lt;&gt;</span>(); <span style=color:#7f848e>// = Arrays.asList(modelMapper.map(stations, RouteStationGraphQLDto[].class));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>stations</span>.<span style=color:#e06c75>forEach</span>(<span style=color:#e06c75>station</span> <span style=color:#56b6c2>-&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#e06c75>RouteStationGraphQLDto</span> <span style=color:#e06c75>tmp</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>modelMapper</span>.<span style=color:#e06c75>map</span>(<span style=color:#e06c75>station</span>,<span style=color:#e06c75>RouteStationGraphQLDto</span>.<span style=color:#e06c75>class</span>);
</span></span><span style=display:flex><span>            <span style=color:#e06c75>tmp</span>.<span style=color:#e06c75>setDistance</span>(<span style=color:#e06c75>GeometryUtil</span>.<span style=color:#e06c75>calculateDistance</span>(<span style=color:#e06c75>x</span>, <span style=color:#e06c75>y</span>, <span style=color:#e06c75>station</span>.<span style=color:#e06c75>getGps</span>().<span style=color:#e06c75>getX</span>(), <span style=color:#e06c75>station</span>.<span style=color:#e06c75>getGps</span>().<span style=color:#e06c75>getY</span>()));
</span></span><span style=display:flex><span>            <span style=color:#e06c75>routeStationDtos</span>.<span style=color:#e06c75>add</span>(<span style=color:#e06c75>tmp</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>        <span style=color:#e06c75>routeStationDtos</span>.<span style=color:#e06c75>sort</span>(<span style=color:#e06c75>Comparator</span>.<span style=color:#e06c75>comparing</span>(<span style=color:#e06c75>RouteStationGraphQLDto</span>::<span style=color:#e06c75>getDistance</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span>(<span style=color:#e06c75>e</span>.<span style=color:#e06c75>getSelectionSet</span>().<span style=color:#e06c75>contains</span>(<span style=color:#98c379>&#34;routes&#34;</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#c678dd>for</span> (<span style=color:#e06c75>RouteStationGraphQLDto</span> <span style=color:#e06c75>routeStationDto</span> : <span style=color:#e06c75>routeStationDtos</span>) {
</span></span><span style=display:flex><span>                <span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>RouteStation</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>routeStations</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>routeStationService</span>.<span style=color:#e06c75>findByStationId</span>(<span style=color:#e06c75>routeStationDto</span>.<span style=color:#e06c75>getStationId</span>());
</span></span><span style=display:flex><span>                <span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>RouteDto</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>routeGraphQLDtos</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Arrays</span>.<span style=color:#e06c75>asList</span>(<span style=color:#e06c75>modelMapper</span>.<span style=color:#e06c75>map</span>(<span style=color:#e06c75>routeStations</span>, <span style=color:#e06c75>RouteDto</span><span style=color:#56b6c2>[]</span>.<span style=color:#e06c75>class</span>));
</span></span><span style=display:flex><span>                <span style=color:#e06c75>routeStationDto</span>.<span style=color:#e06c75>setRoutes</span>(<span style=color:#e06c75>routeGraphQLDtos</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#e06c75>log</span>.<span style=color:#e06c75>info</span>(<span style=color:#98c379>&#34;Query Stations (요청 gps : &#34;</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>x</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>&#34;, &#34;</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>y</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>&#34;) = &#34;</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>routeStationDtos</span>);
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>routeStationDtos</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#61afef>@PreAuthorize</span>(<span style=color:#98c379>&#34;hasAuthority(&#39;bus&#39;)&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e5c07b>boolean</span> <span style=color:#61afef;font-weight:700>getRide</span>(<span style=color:#e06c75>Integer</span> <span style=color:#e06c75>stationId</span>, <span style=color:#e06c75>Integer</span> <span style=color:#e06c75>routeId</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>rideService</span>.<span style=color:#e06c75>getRide</span>(<span style=color:#e06c75>stationId</span>, <span style=color:#e06c75>routeId</span>);
</span></span><span style=display:flex><span>        <span style=color:#e06c75>log</span>.<span style=color:#e06c75>info</span>(<span style=color:#98c379>&#34;Query Ride(stationId : &#34;</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>stationId</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>&#34;, routeId : &#34;</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>routeId</span> );
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e5c07b>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#61afef>@PreAuthorize</span>(<span style=color:#98c379>&#34;hasAuthority(&#39;bus&#39;)&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>RouteDto</span><span style=color:#56b6c2>&gt;</span> <span style=color:#61afef;font-weight:700>getRoutes</span>(<span style=color:#e06c75>String</span> <span style=color:#e06c75>regionName</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Route</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>routes</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>routeService</span>.<span style=color:#e06c75>getRoutes</span>(<span style=color:#98c379>&#34;%&#34;</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>regionName</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>&#34;%&#34;</span>);;
</span></span><span style=display:flex><span>        <span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>RouteDto</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>routeDtos</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Arrays</span>.<span style=color:#e06c75>asList</span>(<span style=color:#e06c75>modelMapper</span>.<span style=color:#e06c75>map</span>(<span style=color:#e06c75>routes</span>, <span style=color:#e06c75>RouteDto</span><span style=color:#56b6c2>[]</span>.<span style=color:#e06c75>class</span>));;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>log</span>.<span style=color:#e06c75>info</span>(<span style=color:#98c379>&#34;Query Routes (요청 지역 이름 : &#34;</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>regionName</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>&#34;) = &#34;</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>routeDtos</span>);
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>routeDtos</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>GraphQL의 contoller역할을 수행하는 QueryResolver의 메서드들에 어노테이션들을 붙여, api-key에 따른 역할을 구분하고 권한인증을 처리하도록 수행해주면 간단한 api-key를 통한 인증이 마무리 된다.</p><p><br><br></p><h2 id=6-결과>6. 결과</h2><img title="image title" loading=lazy decoding=async class="img img-fluid img-center
glightbox" width=1900 height=624 src=/images/projects/spring-graphql/result_hubd21f785acfee0d10827d9a9b370c632_44059_1900x624_fill_q100_lanczos_smart1_3.PNG alt=alter-text onerror='this.onerror="null",this.src="/images/projects/spring-graphql/result_hubd21f785acfee0d10827d9a9b370c632_44059_1900x624_fill_q100_lanczos_smart1_3.PNG"'>
<script>window.addEventListener("load",e=>{const t=GLightbox()})</script><p>http://localhost:8080/playground에 접속해서 header를 셋팅하고 query를 날려보면 정상적으로 응답이 잘 오는 것을 볼 수 있다. 꼭 playground가 아니고 postman과 같은 프로그램을 이용해도 무방하다.</p></div><div class="row items-start justify-between mt-24"><div class="lg:col-5 mb-10 flex items-center lg:mb-0"><h5 class=mr-3>Tags :</h5><ul><li class=inline-block><a class="bg-theme-light hover:bg-primary dark:bg-darkmode-theme-light dark:hover:bg-darkmode-primary dark:hover:text-dark m-1 block rounded px-3 py-1 hover:text-white" href=/tags/spring-boot/>Spring boot</a></li><li class=inline-block><a class="bg-theme-light hover:bg-primary dark:bg-darkmode-theme-light dark:hover:bg-darkmode-primary dark:hover:text-dark m-1 block rounded px-3 py-1 hover:text-white" href=/tags/graphql/>Graphql</a></li><li class=inline-block><a class="bg-theme-light hover:bg-primary dark:bg-darkmode-theme-light dark:hover:bg-darkmode-primary dark:hover:text-dark m-1 block rounded px-3 py-1 hover:text-white" href=/tags/spring-graphql/>Spring graphql</a></li></ul></div><div class="lg:col-5 flex items-center"><div class=share-icons><h5 class=share-title>Share :</h5><a class="share-link share-facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgowoonsori.com%2fblog%2fprojects%2fspring-graphql%2fsecurity%2f" target=_blank rel=noopener aria-label="share facebook"><span class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></span></a><a class="share-link share-twitter" href="https://twitter.com/intent/tweet/?text=Share&amp;url=https%3a%2f%2fgowoonsori.com%2fblog%2fprojects%2fspring-graphql%2fsecurity%2f" target=_blank rel=noopener aria-label="share twitter"><span aria-hidden=true class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5.0-4.55 2.04-4.55 4.54.0.36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3.0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35.0 12.92-6.92 12.92-12.93.0-.2.0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></span></a><a class="share-link share-email" href="mailto:?subject=Share&amp;body=https%3a%2f%2fgowoonsori.com%2fblog%2fprojects%2fspring-graphql%2fsecurity%2f" target=_self rel=noopener aria-label="share email"><span aria-hidden=true class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9.0 6v12c0 1.1.9 2 2 2h20c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17.0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1.0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08.0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></span></a><a class="share-link share-reddit" href="https://reddit.com/submit/?url=https%3a%2f%2fgowoonsori.com%2fblog%2fprojects%2fspring-graphql%2fsecurity%2f&amp;resubmit=true&amp;title=Share" target=_blank rel=noopener aria-label="share reddit"><span aria-hidden=true class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96.0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65.0 3-1.35 3-3s-1.35-3-3-3c-1.38.0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65.0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66.0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64.0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4.0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6.0.23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1.0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1.0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></span></a></div></div></div><div class=mt-16 id=giscusContainer><script>document.addEventListener("DOMContentLoaded",function(){const t={src:"https://giscus.app/client.js","data-repo":"gowoonsori/blog-comments","data-repo-id":"MDEwOlJlcG9zaXRvcnkyOTc4MTY3NDc=","data-category":"Comments","data-category-id":"DIC_kwDOEcBSq84CVvNv","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"1","data-input-position":"top","data-theme":getGiscusTheme(),"data-lang":"ko",crossorigin:"anonymous","data-loading":"lazy",async:""},e=document.createElement("script");Object.entries(t).forEach(([t,n])=>e.setAttribute(t,n)),document.getElementById("giscusContainer").appendChild(e)})</script></div></article></div><div class="section pb-0 pt-32"><h2 class="h3 mb-12">Related Posts</h2><div class=row><div class="lg:col-4 mb-16"><div class="bg-body dark:bg-darkmode-body"><a href=/blog/etc/2020-11-restrospect/><div class="mb-6 w-full rounded px-12 preview empty-preview-box image-random-6"><span>2020년 11월 회고</span></div></a><h4 class=mb-3><a href=/blog/etc/2020-11-restrospect/ class=title>2020년 11월 회고</a></h4><ul class=mb-4><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/%ea%b8%b0%ed%83%80/ class=ms-1>기타</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-clock mr-2"></i>
2020년 11월 7일</li></ul><p class="mb-6 excerpt">블로그 시작한지 2달째 작성해보는 회고 (첫 작성한 블로그 후기 보러가기 ) 블로그 작성을 9월을 시작으로 벌써 2달이라는 시간이 지났다. 두달동안 나름 블로그를 열심히 작성해보겠다고 게시글들을 꽤 많이 작성했는데 지금 회고를 작성하면서 돌이켜 생각해보니 잘못 하고있었구나 생각이 든다. 분명 블로그 작성을 처음 마음먹었을때는 좋은 글솜씨로 작성은...</p><a class="btn btn-outline-primary btn-sm" href=/blog/etc/2020-11-restrospect/>Read More</a></div></div><div class="lg:col-4 mb-16"><div class="bg-body dark:bg-darkmode-body"><a href=/blog/projects/packet-capture/><img src=/images/projects/packet-capture/preview.png alt="Packet Capture Program 만들기" class="mb-6 w-full rounded preview" width=392 height=172></a><h4 class=mb-3><a href=/blog/projects/packet-capture/ class=title>Packet Capture Program 만들기</a></h4><ul class=mb-4><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/projects/ class=ms-1>Projects</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-clock mr-2"></i>
2020년 12월 11일</li></ul><p class="mb-6 excerpt">Linux환경에서 C를 이용해 raw socket을 이용한 tcpdump의 interface를 모방하는 패킷 캡쳐 프로그램 작성하는 것을 목표로 시작했습니다. 캡쳐할 정보는 IPv4(이더넷 타입이 0x0800 (ip헤더의 버전이 4)를 기반으로 2계층인 Ethernet 정보부터 패킷을 수집하여 앞에서부터 잘라내면서, Ethernet header | ip header | TCP/UDP/ICMP header | data(payload) 캡쳐 하는 프로그램...</p><a class="btn btn-outline-primary btn-sm" href=/blog/projects/packet-capture/>Read More</a></div></div><div class="lg:col-4 mb-16"><div class="bg-body dark:bg-darkmode-body"><a href=/blog/projects/react-project/start/><div class="mb-6 w-full rounded px-12 preview empty-preview-box image-random-2"><span>포인트 적립을 위한 웹 제작기</span></div></a><h4 class=mb-3><a href=/blog/projects/react-project/start/ class=title>포인트 적립을 위한 웹 제작기</a></h4><ul class=mb-4><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/projects/ class=ms-1>Projects</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-clock mr-2"></i>
2021년 1월 19일</li></ul><p class="mb-6 excerpt">방학때 엄마집에 있으며 엄마 가게를 도와주다가 갑자기 엄마가 운영하는 꽃집에 포인트 적립을 한번 도입해보고 싶다고 하셨다. 지류로 하는 도장형식은 하기 싫다고 하셨고 운영도 애매하다 하시면서 요즘 태블릿으로 전화번호만 입력하면 포스기랑 연동되어 적립이 된다더라라고 말을 하셨다. 그런데 이는 년단위 계약에 적지 않은 돈을 지불하는 유료 서비스이고 우...</p><a class="btn btn-outline-primary btn-sm" href=/blog/projects/react-project/start/>Read More</a></div></div></div></div></div></section></main><footer class="bg-theme-light dark:bg-darkmode-theme-light"><div class=container><div class="row items-center py-10"><div class="lg:col-3 mb-8 text-center lg:mb-0 lg:text-left"><a class="navbar-brand inline-block" href=/><img fetchpriority=high decoding=async class="img logo-light" width=160 height=32 src=/images/logo_huecbda5afdfa6f2a47d87fa44d8964534_89529_320x0_resize_q90_h2_lanczos_3.webp alt=Gromit.Blog onerror='this.onerror=null,this.src="/images/logo_huecbda5afdfa6f2a47d87fa44d8964534_89529_320x0_resize_lanczos_3.png"'>
<img fetchpriority=high decoding=async class="img logo-dark" width=160 height=32 src=/images/logo-darkmode_hu2877729f4be0141a60f84355100d8d94_80775_320x0_resize_q90_h2_lanczos_3.webp alt=Gromit.Blog onerror='this.onerror=null,this.src="/images/logo-darkmode_hu2877729f4be0141a60f84355100d8d94_80775_320x0_resize_lanczos_3.png"'></a></div><div class="lg:col-6 mb-8 text-center lg:mb-0"><ul></ul></div><div class="lg:col-3 mb-8 text-center lg:mb-0 lg:mt-0 lg:text-right"><ul class=social-icons><li><a target=_blank aria-label=github rel="nofollow noopener" href=https://www.github.com/gowoonsori><i class="fab fa-github"></i></a></li><li><a target=_blank aria-label=linkedin rel="nofollow noopener" href=https://www.linkedin.com/gowoonsori><i class="fab fa-linkedin"></i></a></li><li><a target=_blank aria-label=google rel="nofollow noopener" href=mailto:gowoonsori97@gmail.com><i class="fa-brands fa-google"></i></a></li></ul></div></div></div><div class="border-border dark:border-darkmode-border border-t py-7"><div class="text-light dark:text-darkmode-light container text-center"><p>Developed by <a href=https://github.com/gowoonsori target=_blank>gowoonsori</a></p></div></div></footer><script crossorigin=anonymous integrity="sha256-9XjLB273Xjrt3cq3LF2zQa+fq0rSKxgrV0Hgs1nCeBY=" src=/js/script.min.f578cb076ef75e3aedddcab72c5db341af9fab4ad22b182b5741e0b359c27816.js></script><script crossorigin=anonymous integrity="sha256-B6xkgfh/Kvqv5KhwfzCl2bDxX83d75UmDJHTJqlOs3M=" src=/js/script-lazy.min.07ac6481f87f2afaafe4a8707f30a5d9b0f15fcdddef95260c91d326a94eb373.js defer></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js")</script></body></html>