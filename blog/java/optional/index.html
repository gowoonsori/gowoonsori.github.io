<!doctype html><html itemscope lang=ko-kr itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><meta name=theme-name content="hugoplate"><link rel="shortcut icon" href=/images/favicon_hu2575224fe8b7f0ea91e8825e42ecaf67_1499445_96x0_resize_lanczos_3.png type=image/x-icon><link rel=icon href=/images/favicon_hu2575224fe8b7f0ea91e8825e42ecaf67_1499445_96x0_resize_lanczos_3.png type=image/x-icon><link rel=icon type=image/png sizes=48x48 href=/images/favicon_hu2575224fe8b7f0ea91e8825e42ecaf67_1499445_48x0_resize_lanczos_3.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon_hu2575224fe8b7f0ea91e8825e42ecaf67_1499445_96x0_resize_lanczos_3.png><link rel=apple-touch-icon sizes=144x144 href=/images/favicon_hu2575224fe8b7f0ea91e8825e42ecaf67_1499445_144x0_resize_lanczos_3.png><link rel=manifest href=/manifest.webmanifest><meta name=msapplication-TileColor content="#ddd"><meta name=theme-color content="#ffffff"><base href=https://gowoonsori.com/blog/java/optional/><title>Java Optional</title>
<meta name=generator content="Hugo 0.120.2"><meta name=keywords content="Gromit,Tech,Blog,gowoonsori"><meta name=description content="java8에 추가된 Optional에 대해 설명합니다."><meta name=author content="gowoonsori"><meta property="og:image" content="https://gowoonsori.com/images/java/java.jpg"><meta name=twitter:image content="https://gowoonsori.com/images/java/java.jpg"><meta name=twitter:card content="summary
            _large_image
          "><meta property="og:image:width" content="1280"><meta property="og:image:height" content="768"><meta property="og:image:type" content="image/
        .jpg
      "><meta property="og:title" content="Java Optional"><meta property="og:description" content="java8에 추가된 Optional에 대해 설명합니다."><meta property="og:type" content="website"><meta property="og:url" content="https://gowoonsori.com/blog/java/optional/"><meta name=twitter:title content="Java Optional"><meta name=twitter:description content="java8에 추가된 Optional에 대해 설명합니다."><script async src="https://www.googletagmanager.com/gtag/js?id=G-NB8ZZY0RDG"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NB8ZZY0RDG",{anonymize_ip:!1})}</script><script>!function(){let e=0;document.addEventListener("mousemove",function(){1==++e&&gtmLoader()}),window.onscroll=function(){1==++e&&gtmLoader()},setTimeout(function(){0===e&&(e++,gtmLoader())},5e3)}();function gtmLoader(){(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","G-NB8ZZY0RDG")}</script><script>let indexURL="https://gowoonsori.com/searchindex.json",includeSectionsInSearch=["blog"],no_results_for="No results for",empty_search_results_placeholder="Type something to search.."</script><meta http-equiv=x-dns-prefetch-control content="on"><link rel=preconnect href=https://use.fontawesome.com crossorigin><link rel=preconnect href=//cdnjs.cloudflare.com><link rel=preconnect href=//www.googletagmanager.com><link rel=preconnect href=//www.google-analytics.com><link rel=dns-prefetch href=https://use.fontawesome.com><link rel=dns-prefetch href=//ajax.googleapis.com><link rel=dns-prefetch href=//cdnjs.cloudflare.com><link rel=dns-prefetch href=//www.googletagmanager.com><link rel=dns-prefetch href=//www.google-analytics.com><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//connect.facebook.net><link rel=dns-prefetch href=//platform.linkedin.com><link rel=dns-prefetch href=//platform.twitter.com><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600&family=Signika:wght@500;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><link href="/css/style.min.7f79edb8cd8b89cf1fa077c3ef1fc27c23db7dbf0f36180213e0101f52c366f2.css" integrity="sha256-f3ntuM2Lic8foHfD7x/CfCPbfb8PNhgCE+AQH1LDZvI=" rel=stylesheet><link rel=stylesheet href="/css/style-lazy.min.6ebccd46bdfd6a8861cd49c725f28b8615081591f753245c453e861a11c4b5b4.css" integrity="sha256-brzNRr39aohhzUnHJfKLhhUIFZH3UyRcRT6GGhHEtbQ=" media=print onload='this.media="all",this.onload=null'></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-NB8ZZY0RDG" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><header class="header sticky top-0 z-30"><nav class="navbar container"><div class=order-0><a class="navbar-brand block" href=/><img fetchpriority=high decoding=async class="img logo-light" width=160 height=32 src=/images/logo_huecbda5afdfa6f2a47d87fa44d8964534_89529_320x0_resize_q90_h2_lanczos_3.webp alt=Gromit.Blog onerror='this.onerror=null,this.src="/images/logo_huecbda5afdfa6f2a47d87fa44d8964534_89529_320x0_resize_lanczos_3.png"'>
<img fetchpriority=high decoding=async class="img logo-dark" width=160 height=32 src=/images/logo-darkmode_hu2877729f4be0141a60f84355100d8d94_80775_320x0_resize_q90_h2_lanczos_3.webp alt=Gromit.Blog onerror='this.onerror=null,this.src="/images/logo-darkmode_hu2877729f4be0141a60f84355100d8d94_80775_320x0_resize_lanczos_3.png"'></a></div><input id=nav-toggle type=checkbox class=hidden>
<label for=nav-toggle class="order-3 cursor-pointer flex items-center lg:hidden text-dark dark:text-white lg:order-1"><svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20"><title>Menu Open</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0V0z"/></svg><svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20"><title>Menu Close</title><polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"/></svg></label><ul id=nav-menu class="navbar-nav order-3 hidden lg:flex w-full pb-6 lg:order-1 lg:w-auto lg:space-x-2 lg:pb-0 xl:space-x-8"><li class=nav-item><a class=nav-link href=/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=/categories/>Categories</a></li><li class=nav-item><a class=nav-link href=/tags/>Tags</a></li><li class=nav-item><a class=nav-link href=/about>About</a></li></ul><div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0"><button aria-label=search class="border-border text-dark hover:text-primary dark:border-darkmode-border mr-5 inline-block border-r pr-5 text-xl dark:text-white" data-target=search-modal>
<i class="fa-solid fa-search"></i></button><div class="theme-switcher mr-5"><input id=theme-switcher data-theme-switcher type=checkbox>
<label for=theme-switcher><span class=sr-only>theme switcher</span>
<span><svg class="absolute left-[4px] top-[4px] z-10 opacity-100 dark:opacity-0" viewBox="0 0 56 56" fill="#fff" height="16" width="16"><path d="M30 4.6c0-1-.9-2-2-2a2 2 0 00-2 2v5c0 1 .9 2 2 2s2-1 2-2zm9.6 9a2 2 0 000 2.8c.8.8 2 .8 2.9.0L46 13a2 2 0 000-2.9 2 2 0 00-3 0zm-26 2.8c.7.8 2 .8 2.8.0.8-.7.8-2 0-2.9L13 10c-.7-.7-2-.8-2.9.0-.7.8-.7 2.1.0 3zM28 16A12 12 0 0016 28a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0028 16zm23.3 14c1.1.0 2-.9 2-2s-.9-2-2-2h-4.9a2 2 0 00-2 2c0 1.1 1 2 2 2zM4.7 26a2 2 0 00-2 2c0 1.1.9 2 2 2h4.9c1 0 2-.9 2-2s-1-2-2-2zm37.8 13.6a2 2 0 00-3 0 2 2 0 000 2.9l3.6 3.5a2 2 0 002.9.0c.8-.8.8-2.1.0-3zM10 43.1a2 2 0 000 2.9c.8.7 2.1.8 3 0l3.4-3.5c.8-.8.8-2.1.0-2.9s-2-.8-2.9.0zm20 3.4c0-1.1-.9-2-2-2a2 2 0 00-2 2v4.9c0 1 .9 2 2 2s2-1 2-2z"/></svg><svg class="absolute left-[4px] top-[4px] z-10 opacity-0 dark:opacity-100" viewBox="0 0 24 24" fill="none" height="16" width="16"><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M8.2 2.2c1-.4 2 .6 1.6 1.5-1 3-.4 6.4 1.8 8.7a8.4 8.4.0 008.7 1.8c1-.3 2 .5 1.5 1.5v.1A10.3 10.3.0 0112.4 22 10.3 10.3.0 013.2 6.7c1-2 2.9-3.5 4.9-4.4z"/></svg></span></label></div><script>var darkMode=!0,themeSwitch;localStorage.getItem("theme")==="dark"?darkMode=!0:localStorage.getItem("theme")==="light"&&(darkMode=!1),darkMode&&document.documentElement.classList.toggle("dark"),themeSwitch=document.querySelectorAll("[data-theme-switcher]"),document.addEventListener("DOMContentLoaded",()=>{[].forEach.call(themeSwitch,function(e){e.checked=!!darkMode,e.addEventListener("click",()=>{document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light"),setGiscusTheme()})})});function getGiscusTheme(){return localStorage.getItem("theme")==="dark"?"dark":"light"}function setGiscusTheme(){function e(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}e({setConfig:{theme:getGiscusTheme()}})}</script></div></nav></header><div class="search-wrapper search-modal" data-image=true data-description=true data-tags=true data-categories=true tabindex=-1 aria-hidden=true style=--color-primary:#121212><div class=search-wrapper-content><div class=search-input-body><label for=search-modal-input style=margin-top:-1px><span class=sr-only>search icon</span>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="18" width="18" class="search-icon" data-type="search"><path fill="currentcolor" d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8.0 45.3s-32.8 12.5-45.3.0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9.0 208S93.1.0 208 0 416 93.1 416 208zM208 352a144 144 0 100-288 144 144 0 100 288z"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="18" width="18" class="search-reset" data-type="reset"><path fill="currentcolor" d="M256 512A256 256 0 10256 0a256 256 0 100 512zM175 175c9.4-9.4 24.6-9.4 33.9.0l47 47 47-47c9.4-9.4 24.6-9.4 33.9.0s9.4 24.6.0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6.0 33.9s-24.6 9.4-33.9.0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9.0s-9.4-24.6.0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6.0-33.9z"/></svg></label><input id=search-modal-input type=text data-search-input autocomplete=off aria-label=Search placeholder="Search Post ..."></div><div class=search-wrapper-body><div class=search-result data-search-result></div><span class=search-result-empty>Type something to search..</span></div><div class=search-wrapper-footer><span><kbd><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentcolor" style="margin-top:-2px" viewBox="0 0 16 16"><path d="M3.204 11h9.592L8 5.519 3.204 11zm-.753-.659 4.796-5.48a1 1 0 011.506.0l4.796 5.48c.566.647.106 1.659-.753 1.659H3.204a1 1 0 01-.753-1.659z"/></svg></kbd><kbd><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentcolor" style="margin-top:1px" viewBox="0 0 16 16"><path d="M3.204 5h9.592L8 10.481 3.204 5zm-.753.659 4.796 5.48a1 1 0 001.506.0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 00-.753 1.659z"/></svg></kbd>to navigate
</span><span><kbd><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentcolor" style="display:inline-block" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M14.5 1.5a.5.5.0 01.5.5v4.8a2.5 2.5.0 01-2.5 2.5H2.707l3.347 3.346a.5.5.0 01-.708.708l-4.2-4.2a.5.5.0 010-.708l4-4a.5.5.0 11.708.708L2.707 8.3H12.5A1.5 1.5.0 0014 6.8V2a.5.5.0 01.5-.5z"/></svg></kbd>to select
</span><span class=search-result-info></span>
<span data-target=close-search-modal><kbd>ESC</kbd> to close</span></div></div></div><main><section class="section pt-7"><div class=container><div class="row justify-center"><article class=lg:col-10><h1 class="h2 mb-4">Optional</h1><ul class=mb-4><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/java/ class=ms-1>Java</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-clock mr-2"></i>
2021년 12월 8일</li></ul><div class="content mb-10 mt-9"><p>Java 8에 새로 생긴 인터페이스로 <code>라이브러리 메서드가 반환할 결과값이 없음을 명백하게 표현할 필요가 있는 곳에서 제한적으로 사용할 수 있는 메커니즘을 제공</code>하기 위해 새로 생겨났다.</p><p>Java api doc의 API 노트를 보면 다음과 같이 설명하고 있다. <code>Optional은 주로 결과 없음을 나타낼 필요성이 명확하고 null을 사용하면 오류가 발생할 수 있는 메소드 반환 유형으로 사용하도록 고안되었다.</code></p><p>한마디로 <strong>비어있을 수도 있고, 어떠한 값 하나만 담고 있을수도 있는 인스턴스의 타입</strong></p><br><h2 id=등장-배경>등장 배경</h2><h3 id=1-참조형-멤버변수-와-npe>1. 참조형 멤버변수 와 NPE</h3><ol><li>런타임에 NPE(NullPointerException)라는 예외를 발생시킬 수 있다.</li><li>NPE 방어를 위해서 들어간 null 체크 로직 때문에 코드 가독성과 유지 보수성이 떨어진다.</li></ol><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>/* OnlineClass.java */</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#e06c75>Progress</span> <span style=color:#e06c75>progress</span>;
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e06c75>Progress</span> <span style=color:#61afef;font-weight:700>getProgress</span>() {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>progress</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>public</span> <span style=color:#e5c07b>void</span> <span style=color:#61afef;font-weight:700>setProgress</span>(<span style=color:#e06c75>Progress</span> <span style=color:#e06c75>progress</span>) {
</span></span><span style=display:flex><span>  	    <span style=color:#c678dd>this</span>.<span style=color:#e06c75>progress</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>progress</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>/* OptionalTestApp.java */</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>OnlineClass</span> <span style=color:#e06c75>spring_boot</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>OnlineClass</span>(<span style=color:#e06c75>1</span>, <span style=color:#98c379>&#34;spring boot&#34;</span>, <span style=color:#e5c07b>true</span>); <span style=color:#7f848e>// 이슈상황 → 참조형 멤버 변수 사용 시 초기화 되지 않아 null 값을 참조 할 수 있다.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Duration</span> <span style=color:#e06c75>studyDuration</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>spring_boot</span>.<span style=color:#e06c75>getProgress</span>().<span style=color:#e06c75>getStudyDuration</span>();  <span style=color:#7f848e>// NullPointExecption 발생</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>System</span>.<span style=color:#e06c75>out</span>.<span style=color:#e06c75>println</span>(<span style=color:#e06c75>studyDuration</span>);
</span></span></code></pre></div><p>모든 객체타입은 null을 갖을 수 있기 때문에 해당 값이 null인지 아닌지는 run time에 정확히 알지 못할 수가 있어 NPE를 발생시킬 여지가 있다.</p><br><h4 id=optional-등장-이전-해결방법>Optional 등장 이전 해결방법</h4><ol><li><p>사전에 null 체크</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#e06c75>Progress</span> <span style=color:#61afef;font-weight:700>getProgress</span>() {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>if</span> (<span style=color:#e06c75>progress</span> <span style=color:#56b6c2>==</span> <span style=color:#e5c07b>null</span>) {
</span></span><span style=display:flex><span>		<span style=color:#c678dd>throw</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>IllegalStateException</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#c678dd>return</span> <span style=color:#e06c75>progress</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>이는 에러에 대한 스택트레이스를 뽑게 되고 이또한 리소스 낭비가 될 수 있다.</p></li><li><p>클라이언트 코드에서 null 체크</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#e06c75>Progress</span> <span style=color:#e06c75>progress</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>spring_boot</span>.<span style=color:#e06c75>getProgress</span>();
</span></span><span style=display:flex><span>     <span style=color:#c678dd>if</span> (<span style=color:#e06c75>progress</span> <span style=color:#56b6c2>!=</span> <span style=color:#e5c07b>null</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>System</span>.<span style=color:#e06c75>out</span>.<span style=color:#e06c75>println</span>(<span style=color:#e06c75>progress</span>.<span style=color:#e06c75>getStudyDuration</span>());
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span> }
</span></span></code></pre></div><p>사용하는 시점에 null을 체크하는 방법도 존재하는데 이러면 get 메서드마다 null을 체크하는 코드를 작성해줘야 하고, 비즈니스로직보다 null 체크 코드가 더 길어져 가독성이 떨어질 수 있다.</p></li></ol><p>이러한 문제들을 스칼라나 하스켈과 같은 함수형 언어들은 <code>존재할지 안 할지 모르는 값</code>을 표현할 수 있는 타입을 가지고 있고 자바도 처음 만들어졌을떄 <code>존재하지 않는 값</code>을 표현하기 위해 null을 만들었다면 이번에는 위 언어들의 컨셉을 모티브로 Optional API를 만들고 null 처리를 Optional에게 위임하는 방법으로 해결하고자 추가되었다.</p><br><h2 id=장점>장점</h2><ol><li>NPE를 유발할 수 있는 null을 직접 다루지 않아도 된다.</li><li>수고롭게 null 체크를 직접 하지 않아도 된다.</li><li>명시적으로 해당 변수가 null일 수도 있다는 가능성을 표현할 수 있다. (따라서 불필요한 방어 로직을 줄일 수 있다!)</li></ol><br><h2 id=주의사항-sub-optional-올바르게-사용하는-법>주의사항 (sub. Optional 올바르게 사용하는 법)</h2><h3 id=1-optional-변수에-null-대신-optionalempty-사용>1. Optional 변수에 null 대신 Optional.empty() 사용</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Car</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>optionalCar</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Car</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>optionalCar</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>empty</span>();
</span></span></code></pre></div><p>Optional도 결국 객체이기 때문에 null이 들어갈 수 있는데 이는 또다른 NPE를 유발하는 코드이기 때문에 emtpy()메서드로 비어있는 값을 정의하자.</p><br><h3 id=2-optional-값을-꺼내쓰기-전에-값이-있는지-확인하기>2. Optional 값을 꺼내쓰기 전에 값이 있는지 확인하기</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Car</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>optionalCar</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>empty</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Car</span> <span style=color:#e06c75>car</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>get</span>(); <span style=color:#7f848e>//NoSuchElementException 발생</span>
</span></span></code></pre></div><p>Optional은 값이 비어있을 수도 있기 때문에 사용하기전에 존재한다는 것을 증명해야 하는데 일반적으로는 isPresent()후에 get()을 사용할 수 있지만 코드도 길어지고 한번에 사용할 수 있는 API를 제공하기 때문에 이를 사용하는 것이 바람직하다.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//isPresent - get</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span>(<span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>isPresent</span>()){
</span></span><span style=display:flex><span>    <span style=color:#c678dd>return</span> <span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>get</span>();
</span></span><span style=display:flex><span>}<span style=color:#c678dd>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>return</span> <span style=color:#e5c07b>null</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//orElse</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>return</span> <span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>orElse</span>(<span style=color:#e5c07b>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//orElseGet</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>return</span> <span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>orElseGet</span>(() <span style=color:#56b6c2>-&gt;</span> <span style=color:#e5c07b>null</span>);
</span></span></code></pre></div><p>이때 orElseGet()은 <code>Supplier</code>를 인자로 받으며, 값이 없을때에 해당 supplier가 수행된다. 하지만 orElse()는 Optional로 감싸고 있는 객체타입을 인자로 받으며 값이 있더라도 내부가 수행되고 사용되지 않는 경우 해당 객체를 지우게 되어 <code>필요없는 오버헤드가 발생</code>한다.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//source code</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>String</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>optStr</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>of</span>(<span style=color:#98c379>&#34;Hi&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#e06c75>optStr</span>.<span style=color:#e06c75>orElse</span>(<span style=color:#c678dd>new</span> <span style=color:#e06c75>String</span>(<span style=color:#98c379>&#34;hi1&#34;</span>));
</span></span><span style=display:flex><span><span style=color:#e06c75>optStr</span>.<span style=color:#e06c75>orElseGet</span>(() <span style=color:#56b6c2>-&gt;</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>String</span>(<span style=color:#98c379>&#34;hi1&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//bytecode</span>
</span></span><span style=display:flex><span> <span style=color:#e06c75>L1</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>LINENUMBER</span> <span style=color:#e06c75>9</span> <span style=color:#e06c75>L1</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ALOAD</span> <span style=color:#e06c75>1</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>NEW</span> <span style=color:#e06c75>java</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>String</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>DUP</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>LDC</span> <span style=color:#98c379>&#34;hi&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>INVOKESPECIAL</span> <span style=color:#e06c75>java</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>String</span>.<span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>init</span><span style=color:#56b6c2>&gt;</span> (<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>String</span>;)<span style=color:#e06c75>V</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>INVOKEVIRTUAL</span> <span style=color:#e06c75>java</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>util</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>orElse</span> (<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Object</span>;)<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Object</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>POP</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>L2</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>LINENUMBER</span> <span style=color:#e06c75>11</span> <span style=color:#e06c75>L2</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ALOAD</span> <span style=color:#e06c75>1</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>INVOKEDYNAMIC</span> <span style=color:#61afef;font-weight:700>get</span>()<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>util</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>function</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Supplier</span>; <span style=color:#56b6c2>[</span>
</span></span><span style=display:flex><span>      <span style=color:#7f848e>// handle kind 0x6 : INVOKESTATIC</span>
</span></span><span style=display:flex><span>      <span style=color:#e06c75>java</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>invoke</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>LambdaMetafactory</span>.<span style=color:#e06c75>metafactory</span>(<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>invoke</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>MethodHandles$Lookup</span>;<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>String</span>;<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>invoke</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>MethodType</span>;<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>invoke</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>MethodType</span>;<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>invoke</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>MethodHandle</span>;<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>invoke</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>MethodType</span>;)<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>invoke</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>CallSite</span>;
</span></span><span style=display:flex><span>      <span style=color:#7f848e>// arguments:</span>
</span></span><span style=display:flex><span>      ()<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Object</span>;,
</span></span><span style=display:flex><span>      <span style=color:#7f848e>// handle kind 0x6 : INVOKESTATIC</span>
</span></span><span style=display:flex><span>      <span style=color:#e06c75>study</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>OptionalEx</span>.<span style=color:#e06c75>lambda$main$0</span>()<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>String</span>;,
</span></span><span style=display:flex><span>      ()<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>String</span>;
</span></span><span style=display:flex><span>    <span style=color:#56b6c2>]</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>INVOKEVIRTUAL</span> <span style=color:#e06c75>java</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>util</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>orElseGet</span> (<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>util</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>function</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Supplier</span>;)<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Object</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>POP</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span><span style=color:#c678dd>private</span> <span style=color:#c678dd>static</span> <span style=color:#e06c75>synthetic</span> <span style=color:#61afef;font-weight:700>lambda$main$0</span>()<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>String</span>;
</span></span><span style=display:flex><span> <span style=color:#e06c75>L0</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>LINENUMBER</span> <span style=color:#e06c75>11</span> <span style=color:#e06c75>L0</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>NEW</span> <span style=color:#e06c75>java</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>String</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>DUP</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>LDC</span> <span style=color:#98c379>&#34;hi&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>INVOKESPECIAL</span> <span style=color:#e06c75>java</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>String</span>.<span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>init</span><span style=color:#56b6c2>&gt;</span> (<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>String</span>;)<span style=color:#e06c75>V</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ARETURN</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>MAXSTACK</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>3</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>MAXLOCALS</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>0</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>예를 들어 위와 같은 코드를 작성했을때 optStr은 null이 아니라 new String(&ldquo;hi1&rdquo;)가 실행되지 않을 것 같지만 바이트코드를 보면 새로 문자열을 생성했다가 POP하는 것을 볼 수 있고, orElseGet()은 우리가 lambda에서 봤던것처럼 static 메서드로 생성하여 호출되는 타이밍에 이를 실행해 객체를 생성하는 것을 볼수있어 orElse는 필요없는 오버헤드에 주의해야한다. 하지만 반드시 이미 생성되어있는 객체를 반환하는 것이라면 orElse()를 사용하는 것이 좋을 수도 있다.</p><br><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//before</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span>(<span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>isPresent</span>()){
</span></span><span style=display:flex><span>    <span style=color:#c678dd>return</span> <span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>get</span>();
</span></span><span style=display:flex><span>}<span style=color:#c678dd>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>throw</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>NoSuchElementException</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//after</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>orElseThrow</span>();
</span></span></code></pre></div><p>예외처리를 하는 경우에도 isPresent()를 통한 예외처리보다는 <code>orElseThrow()</code>를 이용하여 예외처리를 하는 것이 바람직하다. 인자로 <code>Supplier</code>를 통해 특정 Exception을 던질 수 있는데 아무것도 주지 않으면 기본적으로 NoSuchElementException을 던진다.</p><br><h3 id=3-optional이-있을때만-이를-소비하여-무언가를-할때는-ispresent가-아닌-ifpresent를-활용>3. Optional이 있을때만 이를 소비하여 무언가를 할때는 isPresent()가 아닌 ifPresent()를 활용</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//before</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span>(<span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>isPresent</span>()){
</span></span><span style=display:flex><span>    <span style=color:#e06c75>System</span>.<span style=color:#e06c75>out</span>.<span style=color:#e06c75>println</span>(<span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>get</span>());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//after</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>optionalCar</span>.<span style=color:#e06c75>ifPresent</span>(<span style=color:#e06c75>System</span>.<span style=color:#e06c75>out</span>::<span style=color:#e06c75>println</span>);
</span></span></code></pre></div><p>이도 orElse()와 같은 메서드들과 같은 이유로 별도로 API를 제공하기 때문에 필요없는 조건절을 추가하지 말고 API를 활용해보자.</p><br><h3 id=4-컬렉션은-optional대신-비어있는-컬렉션을-사용하자>4. 컬렉션은 Optional대신 비어있는 컬렉션을 사용하자.</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//before</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Car</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>cars</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>carFactory</span>.<span style=color:#e06c75>getCars</span>();
</span></span><span style=display:flex><span><span style=color:#c678dd>return</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>ofNullable</span>(<span style=color:#e06c75>cars</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//after</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Car</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>cars</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>carFactory</span>.<span style=color:#e06c75>getCars</span>();
</span></span><span style=display:flex><span><span style=color:#c678dd>return</span> <span style=color:#e06c75>cars</span> <span style=color:#56b6c2>!=</span> <span style=color:#e5c07b>null</span> <span style=color:#56b6c2>?</span> <span style=color:#e06c75>cars</span> : <span style=color:#e06c75>Collections</span>.<span style=color:#e06c75>emptyList</span>();
</span></span></code></pre></div><p>컬렉션들은 자체적으로 비어있는 값을 표현할 수 있는 자료구조이다. 때문에 Optional을 사용할 필요가 없다.</p><br><h3 id=5-컬렉션은-optional로-감싸지말자>5. 컬렉션은 Optional로 감싸지말자.</h3><p>컬렉션 자체가 데이터를 감싼 형태의 객체이고 이도 충분한 API를 제공하기 때문에 한번더 Optional로 감싸면 필요없는 오버헤드가 발생한다. JPA의 메서드를 생성할때도 JPA자체적으로 비어있는 컬렉션을 반환해주므로 Optional로 감쌀 필요가 없다.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//bad</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Car</span><span style=color:#56b6c2>&gt;&gt;</span> <span style=color:#61afef;font-weight:700>findAllByCompanyName</span>(<span style=color:#e06c75>String</span> <span style=color:#e06c75>name</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//good</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>List</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Car</span><span style=color:#56b6c2>&gt;</span> <span style=color:#61afef;font-weight:700>findAllByCompanyName</span>(<span style=color:#e06c75>String</span> <span style=color:#e06c75>name</span>);
</span></span></code></pre></div><br><h3 id=6-컬렉션map의-원소로-optional을-사용하지-말자>6. 컬렉션,Map의 원소로 Optional을 사용하지 말자.</h3><p>컬렉션이나 Map에 들어가는 값들은 애초에 null이 아님을 전제조건으로 만들어진 자료구조이기 때문에 Optional을 사용할 필요가 없다.</p><br><h3 id=7-단일-값을-얻기-위한-목적으로-메서드-체이닝을-하지말자>7. 단일 값을 얻기 위한 목적으로 메서드 체이닝을 하지말자.</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//bad</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>String</span> <span style=color:#e06c75>status</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#34;on&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#c678dd>return</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>ofNullable</span>(<span style=color:#e06c75>status</span>).<span style=color:#e06c75>orElse</span>(<span style=color:#98c379>&#34;PENDING&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//good</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>status</span> <span style=color:#56b6c2>==</span> <span style=color:#e5c07b>null</span> <span style=color:#56b6c2>?</span> <span style=color:#98c379>&#34;PENDING&#34;</span> : <span style=color:#e06c75>status</span>;
</span></span></code></pre></div><p>Optional을 사용하는 것은 결국 또하나의 래퍼객체를 사용하는 것이므로 단순한 로직이라면 그냥 코딩하자. 구관이 명관이라했다.</p><br><h3 id=8-optional을-필드로-사용하지말자>8. Optional을 필드로 사용하지말자.</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#c678dd>class</span> <span style=color:#e5c07b>Car</span> {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>private</span> <span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Navigation</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>navigation</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>empty</span>(); <span style=color:#7f848e>//bad</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Optional은 애초에 필드로 사용할 목적으로 만들어지지 않아 Serializable도 구현하지 않았기 때문에 사용을 지양해야 한다.</p><br><h3 id=9-optional을-메서드생성자-인자로-사용하지말자>9. Optional을 메서드,생성자 인자로 사용하지말자.</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//bad</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#e5c07b>void</span> <span style=color:#61afef;font-weight:700>render</span>(<span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Renderer</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>renderer</span>){
</span></span><span style=display:flex><span>    <span style=color:#e06c75>renderer</span>.<span style=color:#e06c75>orElseThrow</span>(() <span style=color:#56b6c2>-&gt;</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>IllegalArgumentException</span>(<span style=color:#98c379>&#34;null 일 수 없습니다.&#34;</span>));
</span></span><span style=display:flex><span>    <span style=color:#7f848e>//...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//good</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#e5c07b>void</span> <span style=color:#61afef;font-weight:700>render</span>(<span style=color:#e06c75>Renderer</span> <span style=color:#e06c75>renderer</span>){
</span></span><span style=display:flex><span>    <span style=color:#c678dd>if</span>(<span style=color:#e06c75>renderer</span> <span style=color:#56b6c2>==</span> <span style=color:#e5c07b>null</span>){
</span></span><span style=display:flex><span>        <span style=color:#c678dd>throw</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>IllegalArgumentException</span>(<span style=color:#98c379>&#34;null 일 수 없습니다.&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#7f848e>//...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>이러한 방법은 불필요하게 코드를 복잡하게 할 뿐아니라 이를 호출하는 쪽에서도 Optional 생성을 강제하게 하는 것이다. 또한, Optional은 하나의 객체로 이를 호출하는 것이 결코 비용이 저렴하지 않다.</p><br><h3 id=10-null이-확실하면-ofnullable이-아닌-of를-사용하자>10. null이 확실하면 ofNullable()이 아닌 of()를 사용하자.</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//bad</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>ofNullable</span>(<span style=color:#98c379>&#34;NULL일 수 없지!&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//good</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>of</span>(<span style=color:#98c379>&#34;NULL일 수 없지!&#34;</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//ofNullable</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#c678dd>static</span> <span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>T</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>T</span><span style=color:#56b6c2>&gt;</span> <span style=color:#61afef;font-weight:700>ofNullable</span>(<span style=color:#e06c75>T</span> <span style=color:#e06c75>value</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>value</span> <span style=color:#56b6c2>==</span> <span style=color:#e5c07b>null</span> <span style=color:#56b6c2>?</span> <span style=color:#e06c75>empty</span>() : <span style=color:#e06c75>of</span>(<span style=color:#e06c75>value</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ofNullable은 내부적으로 보면 삼항연산자를 통해 비어있지 않는 경우 of를 호출하는 것을 볼 수있다. 그렇기 때문에 이러한 연산을 조금이라도 줄일 수 있기 때문에 of를 사용하자.</p><br><h3 id=11-optional의-타입이-primitive타입이면-optionalintoptionallong-optionaldouble을-사용하자>11. Optional의 타입이 Primitive타입이면 OptionalInt,OptionalLong, OptionalDouble을 사용하자</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>//bad</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Integer</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>max</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>of</span>(<span style=color:#e06c75>10</span>);
</span></span><span style=display:flex><span><span style=color:#c678dd>for</span>(<span style=color:#e5c07b>int</span> <span style=color:#e06c75>i</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>0</span>; <span style=color:#e06c75>i</span> <span style=color:#56b6c2>&lt;</span> <span style=color:#e06c75>max</span>.<span style=color:#e06c75>get</span>(); <span style=color:#e06c75>i</span><span style=color:#56b6c2>++</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//good</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>OptionalInt</span> <span style=color:#e06c75>max</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>OptionalInt</span>.<span style=color:#e06c75>of</span>(<span style=color:#e06c75>10</span>);
</span></span><span style=display:flex><span><span style=color:#c678dd>for</span>(<span style=color:#e5c07b>int</span> <span style=color:#e06c75>i</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>0</span>; <span style=color:#e06c75>i</span> <span style=color:#56b6c2>&lt;</span> <span style=color:#e06c75>max</span>.<span style=color:#e06c75>getAsInt</span>(); <span style=color:#e06c75>i</span><span style=color:#56b6c2>++</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>//byte code</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>L0</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>LINENUMBER</span> <span style=color:#e06c75>10</span> <span style=color:#e06c75>L0</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>BIPUSH</span> <span style=color:#e06c75>10</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>INVOKESTATIC</span> <span style=color:#e06c75>java</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Integer</span>.<span style=color:#e06c75>valueOf</span> (<span style=color:#e06c75>I</span>)<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Integer</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>INVOKESTATIC</span> <span style=color:#e06c75>java</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>util</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>of</span> (<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>lang</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Object</span>;)<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>util</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>Optional</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ASTORE</span> <span style=color:#e06c75>0</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>L1</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>LINENUMBER</span> <span style=color:#e06c75>12</span> <span style=color:#e06c75>L1</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>BIPUSH</span> <span style=color:#e06c75>10</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>INVOKESTATIC</span> <span style=color:#e06c75>java</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>util</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>OptionalInt</span>.<span style=color:#e06c75>of</span> (<span style=color:#e06c75>I</span>)<span style=color:#e06c75>Ljava</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>util</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>OptionalInt</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ASTORE</span> <span style=color:#e06c75>1</span>
</span></span></code></pre></div><p>내부적으로 Integer.valueOf()를 통해 한번 boxing이 일어나는 것을 볼 수 있고 또 이를 사용할때 unboxing이 일어나기 때문에 OptionalInt를 사용하는 것이 좋다.</p><br><h3 id=12-optional을-리턴하는-메서드에서-null을-리턴하지-말자>12. Optional을 리턴하는 메서드에서 null을 리턴하지 말자.</h3><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#c678dd>static</span> <span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>String</span><span style=color:#56b6c2>&gt;</span> <span style=color:#61afef;font-weight:700>hi</span>(){
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e5c07b>null</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>당연한거지만 Optional도 객체이기 때문에 null을 리턴이 가능한데 이렇게 리턴하게 되면 Optional을 사용하는 것이 의미가 없기 때문에 null을 리턴하지 말자.</p><p><br><br></p><h2 id=optional-api>Optional API</h2><h3 id=1-optional-생성>1. Optional 생성</h3><ol><li><p>선언하기</p><p>제네릭을 제공하기 때문에, 변수를 선언할 때 명기한 타입 파라미터에 따라서 감쌀 수 있는 객체의 타입이 결정된다.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Order</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>maybeOrder</span>; <span style=color:#7f848e>// Order 타입의 객체를 감쌀 수 있는 Optional 타입의 변수</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Member</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>optMember</span>; <span style=color:#7f848e>// Member 타입의 객체를 감쌀 수 있는 Optional 타입의 변수</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Address</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>address</span>; <span style=color:#7f848e>// Address 타입의 객체를 감쌀 수 있는 Optional 타입의 변수</span>
</span></span></code></pre></div><p>변수명은 그냥 클래스 이름을 사용하기도 하지만 <code>maybe</code>나 <code>opt</code>와 같은 접두어를 붙여서 Optional 타입의 변수라는 것을 좀 더 명확히 나타내기도 한다.</p></li><li><p>객체 생성하기</p><ul><li><p>Optional.empty() : null을 담고 있는, 한 마디로 비어있는 Optional 객체를 얻어온다.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Member</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>maybeMember</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>empty</span>();
</span></span></code></pre></div><p>이 비어있는 객체는 Optional 내부적으로 미리 생성해놓은 싱글턴 인스턴스이다.</p></li><li><p>Optional.of() : null이 아닌 객체를 담고 있는 Optional 객체를 생성</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Member</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>maybeMember</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>of</span>(<span style=color:#e06c75>aMember</span>);
</span></span></code></pre></div><p>null이 넘어올 경우, NPE를 던지기 때문에 <strong>주의해서 사용하자!</strong></p></li><li><p>Optional.ofNullable() : null인지 아닌지 확신할 수 없는 객체를 담고 있는 Optional 객체를 생성</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Member</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>maybeMember</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>ofNullable</span>(<span style=color:#e06c75>aMember</span>);
</span></span><span style=display:flex><span><span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Member</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>maybeNotMember</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>ofNullable</span>(<span style=color:#e5c07b>null</span>);
</span></span></code></pre></div><p><code>Optional.empty()</code>와 <code>Optional.ofNullable(value)</code>를 합쳐놓은 메소드로 이해하면 편하다. null이 넘어올 경우, NPE를 던지지 않고 <code>Optional.empty()</code>와 동일하게 비어 있는 Optional 객체를 얻어온다.</p><p>해당 객체가 null인지 아닌지 자신이 없는 상황에서는 이 메소드를 사용하자.</p></li></ul></li></ol><br><h3 id=2-optional-값-여부-확인>2. Optional 값 여부 확인</h3><ol><li>isPresent() : 값이 있으면 true, 없으면 false</li><li>isEmpty() : <code>Java11부터 제공</code>하며 값이 없으면 true, 값이 있으면 false</li></ol><br><h3 id=3-optional-값-가져오기>3. Optional 값 가져오기</h3><p>아래 메소드들은 모두 Optional이 담고 있는 객체가 존재할 경우 동일하게 해당 값을 반환하지만, Optional이 비어있는 경우(null을 담고 있는 경우), 다르게 작동한다.</p><ol><li><p>get() : null일 경우 NoSuchElementException 발생히고 <code>가급적 사용을 하지 않는 것을 권장한다.</code></p></li><li><p>orElse(T other) : null일 경우 넘어온 인자(T) 를 반환한다.</p></li><li><p>orElseGet(Supplier&lt;? extends X>) : null일 경우 넘어온 함수형 인자를 통해 생성된 객체를 반환한다.</p><p><code>orElse(T other)</code>의 게으른 버전으로 비어있는 경우에만 함수가 호출되기 때문에 <code>orElse(T other)</code> 대비 성능상 이점을 기대할 수 있다.</p></li><li><p>orElseThrow(Supplier&lt;? extends X> exceptionSupplier) : null일 경우 넘어온 함수형 인자를 통해 생성된 예외(를 던진다. (default : NoSuchElementException)</p></li><li><p>ifPresent(Consumer) : 값이 있는 경우 값을 가지고 Consumer 함수 동작한다.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#7f848e>// 1. get()</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>OnlineClass</span> <span style=color:#e06c75>onlineClass</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>optional</span>.<span style=color:#e06c75>get</span>(); <span style=color:#7f848e>// NoSuchElementException 발생</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>// 2. isPresent() + get() = 먼저 확인후 꺼낸다  번거롭다</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span> (<span style=color:#e06c75>optional</span>.<span style=color:#e06c75>isPresent</span>()) {
</span></span><span style=display:flex><span>	<span style=color:#e06c75>OnlineClass</span> <span style=color:#e06c75>onlineClass</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>optional</span>.<span style=color:#e06c75>get</span>();
</span></span><span style=display:flex><span>	<span style=color:#e06c75>System</span>.<span style=color:#e06c75>out</span>.<span style=color:#e06c75>println</span>(<span style=color:#e06c75>onlineClass</span>.<span style=color:#e06c75>getTitle</span>());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>// 3. ifPresent(Consumer) = 값이 있는 경우만 함수가 동작한다!</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>optional</span>.<span style=color:#e06c75>ifPresent</span>(<span style=color:#e06c75>oc</span> <span style=color:#56b6c2>-&gt;</span> <span style=color:#e06c75>System</span>.<span style=color:#e06c75>out</span>.<span style=color:#e06c75>println</span>(<span style=color:#e06c75>oc</span>.<span style=color:#e06c75>getTitle</span>()));
</span></span></code></pre></div></li></ol><br><h3 id=4-optional-필터변환>4. Optional 필터/변환</h3><ol><li><p>Optional map(Function)</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#7f848e>// AS-WAS</span>
</span></span><span style=display:flex><span> <span style=color:#7f848e>//주문을 한 회원이 살고 있는 도시를 반환하는 메소드다. (기본값은 Seoul 이다.)</span>
</span></span><span style=display:flex><span> <span style=color:#c678dd>public</span> <span style=color:#e06c75>String</span> <span style=color:#61afef;font-weight:700>getCityOfMemberFromOrder</span>(<span style=color:#e06c75>Order</span> <span style=color:#e06c75>order</span>) {
</span></span><span style=display:flex><span>     <span style=color:#c678dd>if</span> (<span style=color:#e06c75>order</span> <span style=color:#56b6c2>==</span> <span style=color:#e5c07b>null</span>) {
</span></span><span style=display:flex><span>         <span style=color:#c678dd>return</span> <span style=color:#98c379>&#34;Seoul&#34;</span>;
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>     <span style=color:#e06c75>Member</span> <span style=color:#e06c75>member</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>order</span>.<span style=color:#e06c75>getMember</span>();
</span></span><span style=display:flex><span>     <span style=color:#c678dd>if</span> (<span style=color:#e06c75>member</span> <span style=color:#56b6c2>==</span> <span style=color:#e5c07b>null</span>) {
</span></span><span style=display:flex><span>         <span style=color:#c678dd>return</span> <span style=color:#98c379>&#34;Seoul&#34;</span>;
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>     <span style=color:#e06c75>Address</span> <span style=color:#e06c75>address</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>member</span>.<span style=color:#e06c75>getAddress</span>();
</span></span><span style=display:flex><span>     <span style=color:#c678dd>if</span> (<span style=color:#e06c75>address</span> <span style=color:#56b6c2>==</span> <span style=color:#e5c07b>null</span>) {
</span></span><span style=display:flex><span>         <span style=color:#c678dd>return</span> <span style=color:#98c379>&#34;Seoul&#34;</span>;
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>     <span style=color:#e06c75>String</span> <span style=color:#e06c75>city</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>address</span>.<span style=color:#e06c75>getCity</span>();
</span></span><span style=display:flex><span>     <span style=color:#c678dd>if</span> (<span style=color:#e06c75>city</span> <span style=color:#56b6c2>==</span> <span style=color:#e5c07b>null</span>) {
</span></span><span style=display:flex><span>         <span style=color:#c678dd>return</span> <span style=color:#98c379>&#34;Seoul&#34;</span>;
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>     <span style=color:#c678dd>return</span> <span style=color:#e06c75>city</span>;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#7f848e>// TO-BE</span>
</span></span><span style=display:flex><span> <span style=color:#c678dd>public</span> <span style=color:#e06c75>String</span> <span style=color:#61afef;font-weight:700>getCityOfMemberFromOrder</span>(<span style=color:#e06c75>Order</span> <span style=color:#e06c75>order</span>) {
</span></span><span style=display:flex><span>     <span style=color:#c678dd>return</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>ofNullable</span>(<span style=color:#e06c75>order</span>)
</span></span><span style=display:flex><span>             .<span style=color:#e06c75>map</span>(<span style=color:#e06c75>Order</span>::<span style=color:#e06c75>getMember</span>)
</span></span><span style=display:flex><span>             .<span style=color:#e06c75>map</span>(<span style=color:#e06c75>Member</span>::<span style=color:#e06c75>getAddress</span>)
</span></span><span style=display:flex><span>             .<span style=color:#e06c75>map</span>(<span style=color:#e06c75>Address</span>::<span style=color:#e06c75>getCity</span>)
</span></span><span style=display:flex><span>             .<span style=color:#e06c75>orElse</span>(<span style=color:#98c379>&#34;Seoul&#34;</span>);
</span></span><span style=display:flex><span> }
</span></span></code></pre></div><p>기존의 방식으로 null check를 하면서 코드를 작성하면 사방에서 return 해줘야 하여 가독성이 떨어지고, 유지보수가 좋지 않은 코드가 있다.</p><p>하지만 Optional과 map을 이용하면 전통적인 NPE 방어 패턴에 비해 훨씬 간결하고 명확해진다!</p><p>우선 기존에 존재하던 조건문들이 모두 사라지고 Optional의 수려한(fluent) API에 의해서 단순한 메소드 체이닝으로 모두 대체된다.</p><ul><li><strong>메소드 체이닝 설명</strong><ol><li><code>ofNullable()</code> 정적 팩토리 메소드를 호출하여 Order 객체를 Optional로 감싸고 혹시 Order 객체가 null인 경우를 대비하여 <code>of()</code> 대신에 <code>ofNullable()</code>을 사용하는 것이다.</li><li>3번의 <code>map()</code> 메소드의 연쇄 호출을 통해서 Optional 객체를 3번 변환한다. 매 번 다른 메소드 레퍼런스를 인자로 넘겨서 Optional에 담긴 객체의 타입을 바꿔준다.</li><li>마무리 작업으로 <code>orElse()</code> 메소드를 호출하여 이 전 과정을 통해 얻은 Optional이 비어있을 경우, 디폴트로 사용할 도시 이름을 세팅해주면 된다.</li></ol></li></ul></li><li><p>Optional filter(Predicate)</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#c678dd>if</span> (<span style=color:#e06c75>obj</span> <span style=color:#56b6c2>!=</span> <span style=color:#e5c07b>null</span> <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>obj</span>.<span style=color:#e06c75>do</span>() ...)
</span></span></code></pre></div><p>Java8 이 전에 NPE 방지를 위해서 위와 같이 null 체크로 시작하는 if 조건문 패턴을 많이 사용해왔고 이러한 패턴을 이용해서 주어진 시간(분) 내에 생성된 주문을 한 경우에만 해당 회원 정보를 구하는 메소드를 작성해보면 아래와 같다.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#e06c75>Member</span> <span style=color:#61afef;font-weight:700>getMemberIfOrderWithin</span>(<span style=color:#e06c75>Order</span> <span style=color:#e06c75>order</span>, <span style=color:#e5c07b>int</span> <span style=color:#e06c75>min</span>) {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>if</span> (<span style=color:#e06c75>order</span> <span style=color:#56b6c2>!=</span> <span style=color:#e5c07b>null</span> <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>order</span>.<span style=color:#e06c75>getDate</span>().<span style=color:#e06c75>getTime</span>() <span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>System</span>.<span style=color:#e06c75>currentTimeMillis</span>() <span style=color:#56b6c2>-</span> <span style=color:#e06c75>min</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>1000</span>) {
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>order</span>.<span style=color:#e06c75>getMember</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>위 코드의 문제점은 두가지가 존재하게 된다. 첫번째로 if 조건문 내에 <strong>null 체크와 비지니스 로직이 혼재</strong>되어 있어서 가독성이 떨어진다는 점이다. 두번째로는 null을 리턴할 수 있기 때문에 메소드 호출부에 NPE 위험을 전파하고 있다는 것이다.</p><br><p>이런 문제점 해결하고자 filter를 적용하면 아래와 같이 코드를 작성 할 수 있다.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#c678dd>public</span> <span style=color:#e06c75>Optional</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Member</span><span style=color:#56b6c2>&gt;</span> <span style=color:#61afef;font-weight:700>getMemberIfOrderWithin</span>(<span style=color:#e06c75>Order</span> <span style=color:#e06c75>order</span>, <span style=color:#e5c07b>int</span> <span style=color:#e06c75>min</span>) {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>return</span> <span style=color:#e06c75>Optional</span>.<span style=color:#e06c75>ofNullable</span>(<span style=color:#e06c75>order</span>)
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>filter</span>(<span style=color:#e06c75>o</span> <span style=color:#56b6c2>-&gt;</span> <span style=color:#e06c75>o</span>.<span style=color:#e06c75>getDate</span>().<span style=color:#e06c75>getTime</span>() <span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>System</span>.<span style=color:#e06c75>currentTimeMillis</span>() <span style=color:#56b6c2>-</span> <span style=color:#e06c75>min</span> <span style=color:#56b6c2>*</span> <span style=color:#e06c75>1000</span>)
</span></span><span style=display:flex><span>            .<span style=color:#e06c75>map</span>(<span style=color:#e06c75>Order</span>::<span style=color:#e06c75>getMember</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Optional과 filter를 이용하면 if 조건문 없이 메소드 연쇄 호출만으로도 좀 더 읽기 편한 코드를 작성할 수 있을 뿐만 아니라, 메소드의 리턴 타입을 Optional로 사용함으로써 호출자에게 해당 메소드가 null을 담고 있는 Optional을 반환할 수도 있다는 것을 명시적으로 알려준다.</p></li><li><p>Optional flatMap(Function) : Optional 안의 인스턴스가 Optional인 경우 사용하면 편리하며 Stream에서 사용하는 경우와 비슷하게 Optional을 한번 분리해서 쪼개주는 걸 뜻한다.</p></li></ol><p><br><br><br></p><hr><h2 id=reference>Reference</h2><p><a href=https://www.inflearn.com/course/the-java-java8/dashboard target=_blank>백기선 인프런 강의 : 더 자바, Java8</a></p><p><a href=https://dzone.com/articles/using-optional-correctly-is-not-optional target=_blank>https://dzone.com/articles/using-optional-correctly-is-not-optional</a></p></div><div class="row items-start justify-between mt-24"><div class="lg:col-5 mb-10 flex items-center lg:mb-0"><h5 class=mr-3>Tags :</h5><ul><li class=inline-block><a class="bg-theme-light hover:bg-primary dark:bg-darkmode-theme-light dark:hover:bg-darkmode-primary dark:hover:text-dark m-1 block rounded px-3 py-1 hover:text-white" href=/tags/java/>Java</a></li></ul></div><div class="lg:col-5 flex items-center"><div class=share-icons><h5 class=share-title>Share :</h5><a class="share-link share-facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgowoonsori.com%2fblog%2fjava%2foptional%2f" target=_blank rel=noopener aria-label="share facebook"><span class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></span></a><a class="share-link share-twitter" href="https://twitter.com/intent/tweet/?text=Share&amp;url=https%3a%2f%2fgowoonsori.com%2fblog%2fjava%2foptional%2f" target=_blank rel=noopener aria-label="share twitter"><span aria-hidden=true class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5.0-4.55 2.04-4.55 4.54.0.36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3.0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35.0 12.92-6.92 12.92-12.93.0-.2.0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></span></a><a class="share-link share-email" href="mailto:?subject=Share&amp;body=https%3a%2f%2fgowoonsori.com%2fblog%2fjava%2foptional%2f" target=_self rel=noopener aria-label="share email"><span aria-hidden=true class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9.0 6v12c0 1.1.9 2 2 2h20c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17.0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1.0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08.0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></span></a><a class="share-link share-reddit" href="https://reddit.com/submit/?url=https%3a%2f%2fgowoonsori.com%2fblog%2fjava%2foptional%2f&amp;resubmit=true&amp;title=Share" target=_blank rel=noopener aria-label="share reddit"><span aria-hidden=true class=share-icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96.0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65.0 3-1.35 3-3s-1.35-3-3-3c-1.38.0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65.0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66.0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64.0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4.0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6.0.23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1.0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1.0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></span></a></div></div></div><div class=mt-16 id=giscusContainer><script>document.addEventListener("DOMContentLoaded",function(){const t={src:"https://giscus.app/client.js","data-repo":"gowoonsori/blog-comments","data-repo-id":"MDEwOlJlcG9zaXRvcnkyOTc4MTY3NDc=","data-category":"Comments","data-category-id":"DIC_kwDOEcBSq84CVvNv","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"1","data-input-position":"top","data-theme":getGiscusTheme(),"data-lang":"ko",crossorigin:"anonymous","data-loading":"lazy",async:""},e=document.createElement("script");Object.entries(t).forEach(([t,n])=>e.setAttribute(t,n)),document.getElementById("giscusContainer").appendChild(e)})</script></div></article></div><div class="section pb-0 pt-32"><h2 class="h3 mb-12">Related Posts</h2><div class=row><div class="lg:col-4 mb-16"><div class="bg-body dark:bg-darkmode-body"><a href=/blog/golang/operator/><img src=/images/golang/golang.png alt=연산자 class="mb-6 w-full rounded preview" width=392 height=172></a><h4 class=mb-3><a href=/blog/golang/operator/ class=title>연산자</a></h4><ul class=mb-4><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/golang/ class=ms-1>Golang</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-clock mr-2"></i>
2021년 5월 28일</li></ul><p class="mb-6 excerpt">1. 산술 연산자 구분 연산자 연산 피연산자 타입 사칙 연산과 나머지 + 덧셈 정수, 실수, 복소수, 문자열 - 뺄셈 정수, 실수, 복소수 * 곱셈 정수, 실수, 복소수 / 나눗셈 정수, 실수, 복소수 % 나머지 정수, 실수, 복소수 비트 연산 & AND 비트연산 정수 | OR비트 연산 정수 ^ XOR비트 연산 정수 &^ 비트 클리어 정수 시프트 연산 &#171; 왼쪽 시프트 정수 &#171; 양의 정수...</p><a class="btn btn-outline-primary btn-sm" href=/blog/golang/operator/>Read More</a></div></div><div class="lg:col-4 mb-16"><div class="bg-body dark:bg-darkmode-body"><a href=/blog/books/developing-ms-starting-with-ddd/><img src=/images/books/developing-ms-starting-with-ddd/preview.png alt="도메인 주도 설계로 시작하는 마이크로 서비스 개발" class="mb-6 w-full rounded preview" width=392 height=172></a><h4 class=mb-3><a href=/blog/books/developing-ms-starting-with-ddd/ class=title>도메인 주도 설계로 시작하는 마이크로 서비스 개발</a></h4><ul class=mb-4><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/books/ class=ms-1>Books</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-clock mr-2"></i>
2021년 12월 27일</li></ul><p class="mb-6 excerpt">1. 마이크로서비스를 위한 조건 1) 업무 기능 중심의 팀 기술별로 팀이 나눠지게 되면 서비스 한개를 개발하는데 많은 의사소통이 필요하고 의사결정이 느려진다. 업무기능을 중심으로 다양한 기술을 가진 사람들이 하나의 팀이 되어 서비스를 만들어야 한다. 2) 폴리글랏 프로그래밍 각각의 서비스에 맞는 효율적인 방법론과 도구, 기술을 찾아 적용. 3) 개발 생명주기...</p><a class="btn btn-outline-primary btn-sm" href=/blog/books/developing-ms-starting-with-ddd/>Read More</a></div></div><div class="lg:col-4 mb-16"><div class="bg-body dark:bg-darkmode-body"><a href=/blog/java/list-array/><img src=/images/java/java.jpg alt="List를 Array로 Array를 List로 변환" class="mb-6 w-full rounded preview" width=392 height=172></a><h4 class=mb-3><a href=/blog/java/list-array/ class=title>List를 Array로 Array를 List로 변환</a></h4><ul class=mb-4><li class="mr-4 inline-block"><i class="fa-regular fa-folder mr-2"></i>
<a href=/categories/java/ class=ms-1>Java</a></li><li class="mr-4 inline-block"><i class="fa-regular fa-clock mr-2"></i>
2021년 5월 27일</li></ul><p class="mb-6 excerpt">List와 Array간의 변환은 기본적으로 for문을 이용하여 하나하나 바꾸어주면 변환이 가능하다. 하지만 for이 아닌 stream API를 이용해서 더 간편하게 바꿀 수 있는 방법을 정리한다. 1. List에서 Array로 변환 1) List -> Object[] List&lt;Integer> integerList = new ArrayList&lt;>(); List&lt;String> stringList = new ArrayList&lt;>(); Integer[] integerArr = integerList.toArray(new Integer[integerList.size()]); String[] stringArr = stringList.toArray(new String[stringList.size()]); Object[] objectArr = integerList.toArray(); List에서 Wrapper객체배열로 바꾸는 것은 Li...</p><a class="btn btn-outline-primary btn-sm" href=/blog/java/list-array/>Read More</a></div></div></div></div></div></section></main><footer class="bg-theme-light dark:bg-darkmode-theme-light"><div class=container><div class="row items-center py-10"><div class="lg:col-3 mb-8 text-center lg:mb-0 lg:text-left"><a class="navbar-brand inline-block" href=/><img fetchpriority=high decoding=async class="img logo-light" width=160 height=32 src=/images/logo_huecbda5afdfa6f2a47d87fa44d8964534_89529_320x0_resize_q90_h2_lanczos_3.webp alt=Gromit.Blog onerror='this.onerror=null,this.src="/images/logo_huecbda5afdfa6f2a47d87fa44d8964534_89529_320x0_resize_lanczos_3.png"'>
<img fetchpriority=high decoding=async class="img logo-dark" width=160 height=32 src=/images/logo-darkmode_hu2877729f4be0141a60f84355100d8d94_80775_320x0_resize_q90_h2_lanczos_3.webp alt=Gromit.Blog onerror='this.onerror=null,this.src="/images/logo-darkmode_hu2877729f4be0141a60f84355100d8d94_80775_320x0_resize_lanczos_3.png"'></a></div><div class="lg:col-6 mb-8 text-center lg:mb-0"><ul></ul></div><div class="lg:col-3 mb-8 text-center lg:mb-0 lg:mt-0 lg:text-right"><ul class=social-icons><li><a target=_blank aria-label=github rel="nofollow noopener" href=https://www.github.com/gowoonsori><i class="fab fa-github"></i></a></li><li><a target=_blank aria-label=linkedin rel="nofollow noopener" href=https://www.linkedin.com/gowoonsori><i class="fab fa-linkedin"></i></a></li><li><a target=_blank aria-label=google rel="nofollow noopener" href=mailto:gowoonsori97@gmail.com><i class="fa-brands fa-google"></i></a></li></ul></div></div></div><div class="border-border dark:border-darkmode-border border-t py-7"><div class="text-light dark:text-darkmode-light container text-center"><p>Developed by <a href=https://github.com/gowoonsori target=_blank>gowoonsori</a></p></div></div></footer><script crossorigin=anonymous integrity="sha256-9XjLB273Xjrt3cq3LF2zQa+fq0rSKxgrV0Hgs1nCeBY=" src=/js/script.min.f578cb076ef75e3aedddcab72c5db341af9fab4ad22b182b5741e0b359c27816.js></script><script crossorigin=anonymous integrity="sha256-B6xkgfh/Kvqv5KhwfzCl2bDxX83d75UmDJHTJqlOs3M=" src=/js/script-lazy.min.07ac6481f87f2afaafe4a8707f30a5d9b0f15fcdddef95260c91d326a94eb373.js defer></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js")</script></body></html>